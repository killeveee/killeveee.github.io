<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    

<script>!function(){var e=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches,t=localStorage.getItem("use-color-scheme")||"auto";("dark"===t||e&&"light"!==t)&&document.documentElement.classList.toggle("dark",!0)}()</script>

<meta charset="utf-8" >

<title>CTFdåŠ¨æ€é¶æœºæ­å»º</title>
<meta name="keywords" content="CTFdåŠ¨æ€é¶æœºæ­å»º, killeveee">
<meta name="description" content="åŸºäºdockeræ­å»ºæ”¯æŒåŠ¨æ€é¶æœºçš„é¶åœº">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="stylesheet" href="/style/main.css">


<link rel="stylesheet" href="/style/jquery.fancybox.min.css">




    <link rel="stylesheet" href="/style/prism.css"/>




  <meta name="generator" content="Hexo 6.1.0"></head>
  <body>
    <div id="app" class="main">

<div class="site-header-container">
  <div class="site-header">
    <div class="left">
      <a href="https://killeveee.github.io/archives">
        <img class="avatar" src="/images/avatar.png" alt="logo" width="32px" height="32px">
      </a>
      <a href="https://killeveee.github.io/archives">
        <h1 class="site-title">killeveee</h1>
      </a>
    </div>
    <div class="right">
        <i class="icon menu-switch icon-menu-outline" ></i>
    </div>
  </div>
</div>

<div class="menu-container" style="height: 0;opacity: 0;">
<nav class="menu-list">
  
    
      <a href="/archives" class="menu purple-link">
        Index
      </a>
    
  
    
      <a href="/tags" class="menu purple-link">
        Tags
      </a>
    
  
    
      <a href="/about" class="menu purple-link">
        About
      </a>
    
  
</nav>
</div>



  <div class="content-container">
    <div class="post-detail">
      
      <h2 class="post-title">CTFdåŠ¨æ€é¶æœºæ­å»º</h2>
      <div class="post-info post-detail-info">
        <span><i class="icon icon-calendar-outline"></i> 2022-08-30</span>
        
          <span>
          <i class="icon icon-pricetags-outline"></i>
            
              <a href="/tags/%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/">
              ç¯å¢ƒæ­å»º
                
              </a>
            
          </span>
        
      </div>
      <div class="post-content-wrapper">
        <div class="post-content">
          <h1 id="åŸºäºdockeræ­å»ºæ”¯æŒåŠ¨æ€é¶æœºçš„é¶åœº"><a href="#åŸºäºdockeræ­å»ºæ”¯æŒåŠ¨æ€é¶æœºçš„é¶åœº" class="headerlink" title="åŸºäºdockeræ­å»ºæ”¯æŒåŠ¨æ€é¶æœºçš„é¶åœº"></a>åŸºäºdockeræ­å»ºæ”¯æŒåŠ¨æ€é¶æœºçš„é¶åœº</h1><p>æ¯åšä¸€é“é¢˜ï¼Œå°±ä¼šè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªè™šæ‹Ÿé¢˜ç›®ç¯å¢ƒï¼Œæ¯ä¸€ä¸ªç¯å¢ƒåˆšåˆšç”Ÿæˆçš„æ—¶å€™éƒ½æ˜¯å´­æ–°çš„ã€‚</p>
<h2 id="æˆ‘çš„ç¯å¢ƒ"><a href="#æˆ‘çš„ç¯å¢ƒ" class="headerlink" title="æˆ‘çš„ç¯å¢ƒ"></a>æˆ‘çš„ç¯å¢ƒ</h2><ul>
<li>ä¸»æœºï¼šè…¾è®¯äº‘çš„è½»é‡æœåŠ¡å™¨CentOS7.6-Docker20</li>
<li>Dockerç‰ˆæœ¬ï¼š20.10.17</li>
<li>Docker-composeç‰ˆæœ¬ï¼š20.10.17</li>
<li>IPåœ°å€ï¼šå…¬ç½‘åœ°å€</li>
</ul>
<p>ç„¶åå°±å®Œå…¨æŒ‰ç…§è¿™ä¸ªé“¾æ¥ä¸Šçš„åšğŸ§ğŸ§ğŸ§ï¼š</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://www.yuque.com/docs/share/364ef08c-9405-45fe-b269-e9236de57242#OE1rs">https://www.yuque.com/docs/share/364ef08c-9405-45fe-b269-e9236de57242?#OE1rs</a></li>
</ul>
<p>æˆæœï¼š</p>
<p><img src="/images/ctfd.png" alt="ctfd"></p>
<h2 id="ç³»ç»Ÿç¯å¢ƒæ­å»ºé…ç½®"><a href="#ç³»ç»Ÿç¯å¢ƒæ­å»ºé…ç½®" class="headerlink" title="ç³»ç»Ÿç¯å¢ƒæ­å»ºé…ç½®"></a>ç³»ç»Ÿç¯å¢ƒæ­å»ºé…ç½®</h2><p>æ›´æ–°yumæºï¼Œå’Œå®‰è£…ç³»ç»Ÿç¯å¢ƒæ‰€éœ€æœåŠ¡ï¼š</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">yum update
yum <span class="token function">install</span> -y <span class="token function">git</span> nginx mariadb mariadb-server Mysql-python python-pip gcc  python-devel yum-utils device-mapper-persistent-data lvm2 epel-release<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>å› ä¸ºæˆ‘çš„vpsè‡ªå¸¦äº†dockerï¼Œå°±ä¸å®‰è£…äº†ã€‚</p>
<h2 id="é¶åœºç¯å¢ƒ"><a href="#é¶åœºç¯å¢ƒ" class="headerlink" title="é¶åœºç¯å¢ƒ"></a>é¶åœºç¯å¢ƒ</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">cd</span> ~
<span class="token function">git</span> clone https://github.com/glzjin/CTFd.git
<span class="token function">wget</span> https://github.com/fatedier/frp/releases/download/v0.29.0/frp_0.29.0_linux_amd64.tar.gz
<span class="token function">tar</span> -zxvf frp_0.29.0_linux_amd64.tar.gz
<span class="token function">git</span> clone https://github.com/glzjin/CTFd-Whale.git
<span class="token function">mv</span> CTFd-Whale/ ctfd-whale
<span class="token function">git</span> clone https://github.com/glzjin/Frp-Docker-For-CTFd-Whale
<span class="token function">mv</span> Frp-Docker-For-CTFd-Whale/ frp-docker-for-ctfd-whale
<span class="token function">docker</span> swarm init
<span class="token function">docker</span> <span class="token function">node</span> update --label-add<span class="token operator">=</span><span class="token string">'name=linux-1'</span> <span class="token variable"><span class="token variable">$(</span><span class="token function">docker</span> <span class="token function">node</span> <span class="token function">ls</span> -q<span class="token variable">)</span></span>
<span class="token function">mv</span> ctfd-whale/ CTFd/CTFd/plugins/
<span class="token builtin class-name">cd</span> frp-docker-for-ctfd-whale
<span class="token function">docker-compose</span> up -d
<span class="token builtin class-name">cd</span> ~/CTFd
<span class="token function">mkdir</span> frpc
<span class="token builtin class-name">cd</span> ~/frp_0.29.0_linux_amd64
<span class="token function">mv</span> frpc.ini <span class="token punctuation">..</span>/CTFd/frpc/
<span class="token function">mv</span> frpc_full.ini <span class="token punctuation">..</span>/CTFd/frpc/
<span class="token function">mv</span> frpc <span class="token punctuation">..</span>/CTFd/frpc/
<span class="token function">mv</span> LICENSE <span class="token punctuation">..</span>/CTFd/frpc/
<span class="token builtin class-name">cd</span> ~/CTFd/frpc
<span class="token function">vim</span> frpc.ini<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>frpc.iniçš„å†…å®¹ä¿®æ”¹å¦‚ä¸‹ï¼š</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>common<span class="token punctuation">]</span>
token <span class="token operator">=</span> randomme
server_addr <span class="token operator">=</span> <span class="token number">172.1</span>.0.4
server_port <span class="token operator">=</span> <span class="token number">6490</span>
pool_count <span class="token operator">=</span> <span class="token number">200</span>
tls_enable <span class="token operator">=</span> <span class="token boolean">true</span>

admin_addr <span class="token operator">=</span> <span class="token number">172.1</span>.0.3
admin_port <span class="token operator">=</span> <span class="token number">7400</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">cd</span> ~/CTFd
<span class="token function">vim</span> Dockerfile<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>Dockerfileçš„å†…å®¹å¦‚ä¸‹ï¼š</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">FROM python:3.6-alpine
RUN <span class="token function">sed</span> -i <span class="token string">'s/dl-cdn.alpinelinux.org/mirrors.aliyun.com/g'</span> /etc/apk/repositories <span class="token operator">&amp;&amp;</span><span class="token punctuation">\</span>
    apk update <span class="token operator">&amp;&amp;</span> <span class="token punctuation">\</span>
    apk <span class="token function">add</span> python3 python3-dev linux-headers libffi-dev gcc <span class="token function">make</span> musl-dev py-pip mysql-client <span class="token function">git</span> openssl-dev g++
RUN adduser -D -u <span class="token number">1001</span> -s /bin/bash ctfd
WORKDIR /opt/CTFd
RUN <span class="token function">mkdir</span> -p /opt/CTFd /var/log/CTFd /var/uploads
RUN pip3 config <span class="token builtin class-name">set</span> global.index-url https://pypi.doubanio.com/simple
RUN pip3 config <span class="token builtin class-name">set</span> install.trusted-host pypi.doubanio.com
COPY requirements.txt <span class="token builtin class-name">.</span>
RUN pip <span class="token function">install</span> -r requirements.txt -i  https://pypi.doubanio.com/simple
COPY <span class="token builtin class-name">.</span> /opt/CTFd
RUN <span class="token keyword">for</span> <span class="token for-or-select variable">d</span> <span class="token keyword">in</span> CTFd/plugins/*<span class="token punctuation">;</span> <span class="token keyword">do</span> <span class="token punctuation">\</span>
      <span class="token keyword">if</span> <span class="token punctuation">[</span> -f <span class="token string">"<span class="token variable">$d</span>/requirements.txt"</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span> <span class="token punctuation">\</span>
        pip <span class="token function">install</span> -r <span class="token variable">$d</span>/requirements.txt -i  https://pypi.doubanio.com/simple<span class="token punctuation">;</span> <span class="token punctuation">\</span>
      <span class="token keyword">fi</span><span class="token punctuation">;</span> <span class="token punctuation">\</span>
    <span class="token keyword">done</span><span class="token punctuation">;</span>
RUN <span class="token function">chmod</span> +x /opt/CTFd/docker-entrypoint.sh
RUN <span class="token function">chown</span> -R <span class="token number">1001</span>:1001 /opt/CTFd
RUN <span class="token function">chown</span> -R <span class="token number">1001</span>:1001 /var/log/CTFd /var/uploads
<span class="token environment constant">USER</span> <span class="token number">1001</span>
EXPOSE <span class="token number">8000</span>
ENTRYPOINT <span class="token punctuation">[</span><span class="token string">"/opt/CTFd/docker-entrypoint.sh"</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">vim</span> docker-compose.yml<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>docker-compose.ymlçš„å†…å®¹å¦‚ä¸‹ï¼š</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">version: <span class="token string">'2.2'</span>

services:
  ctfd-nginx:
    image: nginx:1.17
    volumes:
      - ./nginx/http.conf:/etc/nginx/nginx.conf   
    user: root
    restart: always
    ports:    
      - <span class="token string">"443:443"</span>
    networks:
        default:
        internal:
    depends_on:
      - ctfd
    cpus: <span class="token string">'1.00'</span>  
    mem_limit: 150M     
  ctfd:
    build: <span class="token builtin class-name">.</span>
    user: root
    restart: always
    ports:
      - <span class="token string">"8000:8000"</span>     
    environment:
      - <span class="token assign-left variable">UPLOAD_FOLDER</span><span class="token operator">=</span>/var/uploads
      - <span class="token assign-left variable">DATABASE_URL</span><span class="token operator">=</span>mysql+pymysql://root:ctfd@db/ctfd
      - <span class="token assign-left variable">REDIS_URL</span><span class="token operator">=</span>redis://cache:6379
      - <span class="token assign-left variable">WORKERS</span><span class="token operator">=</span><span class="token number">1</span>
      - <span class="token assign-left variable">LOG_FOLDER</span><span class="token operator">=</span>/var/log/CTFd
      - <span class="token assign-left variable">ACCESS_LOG</span><span class="token operator">=</span>-
      - <span class="token assign-left variable">ERROR_LOG</span><span class="token operator">=</span>-
      - <span class="token assign-left variable">REVERSE_PROXY</span><span class="token operator">=</span>true
    volumes:
      - .data/CTFd/logs:/var/log/CTFd
      - .data/CTFd/uploads:/var/uploads
      - .:/opt/CTFd:ro
      - /var/run/docker.sock:/var/run/docker.sock     
    depends_on:
      - db
    networks:
        default:
        internal:
        frp:
            ipv4_address: <span class="token number">172.1</span>.0.2
    cpus: <span class="token string">'1.00'</span>     
    mem_limit: 450M     

  db:
    image: mariadb:10.4
    restart: always
    environment:
      - <span class="token assign-left variable">MYSQL_ROOT_PASSWORD</span><span class="token operator">=</span>ctfd
      - <span class="token assign-left variable">MYSQL_USER</span><span class="token operator">=</span>ctfd
      - <span class="token assign-left variable">MYSQL_PASSWORD</span><span class="token operator">=</span>ctfd
    volumes:
      - .data/mysql:/var/lib/mysql
    networks:
        internal:
    command: <span class="token punctuation">[</span>mysqld, --character-set-server<span class="token operator">=</span>utf8mb4, --collation-server<span class="token operator">=</span>utf8mb4_unicode_ci, --wait_timeout<span class="token operator">=</span><span class="token number">28800</span>, --log-warnings<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">]</span>
    cpus: <span class="token string">'1.00'</span>     
    mem_limit: 750M     

  cache:
    image: redis:4
    restart: always
    volumes:
      - .data/redis:/data
    networks:
        internal:
    cpus: <span class="token string">'1.00'</span>     
    mem_limit: 450M     

  frpc:    
    image: glzjin/frp:latest     
    restart: always
    volumes:
      - ./frpc:/conf/     
    entrypoint:
        - /usr/local/bin/frpc
        - -c
        - /conf/frpc.ini
    networks:
        frp:
            ipv4_address: <span class="token number">172.1</span>.0.3  
        frp-containers:
    cpus: <span class="token string">'1.00'</span>     
    mem_limit: 250M     

networks:
    default:
    internal:
        internal: <span class="token boolean">true</span>
    frp:
        driver: bridge
        ipam:
            config:
                - subnet: <span class="token number">172.1</span>.0.0/16
    frp-containers:
        driver: overlay
        internal: <span class="token boolean">true</span>
        ipam:
            config:
                - subnet: <span class="token number">172.2</span>.0.0/16


<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">vim</span> requirements.txt<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>requirements.txtçš„å†…å®¹å¦‚ä¸‹ï¼š</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token assign-left variable">Flask</span><span class="token operator">==</span><span class="token number">1.1</span>.1
<span class="token assign-left variable">Werkzeug</span><span class="token operator">==</span><span class="token number">0.16</span>.0
Flask-SQLAlchemy<span class="token operator">==</span><span class="token number">2.4</span>.1
Flask-Caching<span class="token operator">==</span><span class="token number">1.4</span>.0
Flask-Migrate<span class="token operator">==</span><span class="token number">2.5</span>.2
Flask-Script<span class="token operator">==</span><span class="token number">2.0</span>.6
<span class="token assign-left variable">SQLAlchemy</span><span class="token operator">==</span><span class="token number">1.3</span>.11
SQLAlchemy-Utils<span class="token operator">==</span><span class="token number">0.36</span>.0
<span class="token assign-left variable">passlib</span><span class="token operator">==</span><span class="token number">1.7</span>.2
<span class="token assign-left variable">bcrypt</span><span class="token operator">==</span><span class="token number">3.1</span>.7
<span class="token assign-left variable">six</span><span class="token operator">==</span><span class="token number">1.13</span>.0
<span class="token assign-left variable">itsdangerous</span><span class="token operator">==</span><span class="token number">1.1</span>.0
requests<span class="token operator">>=</span><span class="token number">2.20</span>.0
<span class="token assign-left variable">PyMySQL</span><span class="token operator">==</span><span class="token number">0.9</span>.3
<span class="token assign-left variable">gunicorn</span><span class="token operator">==</span><span class="token number">19.9</span>.0
<span class="token assign-left variable">normality</span><span class="token operator">==</span><span class="token number">2.0</span>.0
<span class="token assign-left variable">dataset</span><span class="token operator">==</span><span class="token number">1.1</span>.2
<span class="token assign-left variable">mistune</span><span class="token operator">==</span><span class="token number">0.8</span>.4
<span class="token assign-left variable">netaddr</span><span class="token operator">==</span><span class="token number">0.7</span>.19
<span class="token assign-left variable">redis</span><span class="token operator">==</span><span class="token number">3.3</span>.11
<span class="token assign-left variable">datafreeze</span><span class="token operator">==</span><span class="token number">0.1</span>.0
python-dotenv<span class="token operator">==</span><span class="token number">0.10</span>.3
flask-restplus<span class="token operator">==</span><span class="token number">0.13</span>.0
<span class="token assign-left variable">pathlib2</span><span class="token operator">==</span><span class="token number">2.3</span>.5
flask-marshmallow<span class="token operator">==</span><span class="token number">0.10</span>.1
marshmallow-sqlalchemy<span class="token operator">==</span><span class="token number">0.17</span>.0
<span class="token assign-left variable">boto3</span><span class="token operator">==</span><span class="token number">1.10</span>.39
<span class="token assign-left variable">marshmallow</span><span class="token operator">==</span><span class="token number">2.20</span>.2
<span class="token assign-left variable">gevent</span><span class="token operator">==</span><span class="token number">1.4</span>.0
<span class="token assign-left variable">tzlocal</span><span class="token operator">==</span><span class="token number">2.1</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">mkdir</span> nginx
<span class="token builtin class-name">cd</span> nginx
<span class="token function">vim</span> http.conf<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>http.confçš„å†…å®¹å¦‚ä¸‹ï¼š</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">worker_processes <span class="token number">4</span><span class="token punctuation">;</span>
events <span class="token punctuation">&#123;</span>
  worker_connections <span class="token number">1024</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
http <span class="token punctuation">&#123;</span>
  <span class="token comment"># Configuration containing list of application servers</span>
  upstream app_servers <span class="token punctuation">&#123;</span>
    server ctfd:8000<span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  server <span class="token punctuation">&#123;</span>
    listen <span class="token number">80</span><span class="token punctuation">;</span>
    client_max_body_size 4G<span class="token punctuation">;</span>
    <span class="token comment"># Handle Server Sent Events for Notifications</span>
    location /events <span class="token punctuation">&#123;</span>
      proxy_pass http://app_servers<span class="token punctuation">;</span>
      proxy_set_header Connection <span class="token string">''</span><span class="token punctuation">;</span>
      proxy_http_version <span class="token number">1.1</span><span class="token punctuation">;</span>
      chunked_transfer_encoding off<span class="token punctuation">;</span>
      proxy_buffering off<span class="token punctuation">;</span>
      proxy_cache off<span class="token punctuation">;</span>
      proxy_redirect off<span class="token punctuation">;</span>
      proxy_set_header Host <span class="token variable">$host</span><span class="token punctuation">;</span>
      proxy_set_header X-Real-IP <span class="token variable">$remote_addr</span><span class="token punctuation">;</span>
      proxy_set_header X-Forwarded-For <span class="token variable">$proxy_add_x_forwarded_for</span><span class="token punctuation">;</span>
      proxy_set_header X-Forwarded-Host <span class="token variable">$server_name</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token comment"># Proxy connections to the application servers</span>
    location / <span class="token punctuation">&#123;</span>
      proxy_pass http://app_servers<span class="token punctuation">;</span>
      proxy_redirect off<span class="token punctuation">;</span>
      proxy_set_header Host <span class="token variable">$host</span><span class="token punctuation">;</span>
      proxy_set_header X-Real-IP <span class="token variable">$remote_addr</span><span class="token punctuation">;</span>
      proxy_set_header X-Forwarded-For <span class="token variable">$proxy_add_x_forwarded_for</span><span class="token punctuation">;</span>
      proxy_set_header X-Forwarded-Host <span class="token variable">$server_name</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">cd</span> ~/CTFd
<span class="token function">docker-compose</span> up -d
<span class="token function">docker</span> network connect --ip <span class="token number">172.1</span>.0.3 ctfd_frp ctfd_frpc_1
<span class="token function">docker</span> network connect --ip <span class="token number">172.1</span>.0.4 ctfd_frp frp-docker-for-ctfd-whale_frps_1<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>æœ€å</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">docker</span> <span class="token function">ps</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>æŸ¥çœ‹å®¹å™¨ï¼Œåº”è¯¥æœ‰6ä¸ªå®¹å™¨ï¼Œä¸”æŸ¥çœ‹çŠ¶æ€STATUSæ˜¯å¦æ˜¯UPã€‚æ˜¯UPå°±OKã€‚</p>
<p>åœ¨æµè§ˆå™¨è®¿é—®ï¼š<a target="_blank" rel="noopener" href="http://ip:8000/">http://ip:8000</a> å³å¯æ‰“å¼€ã€‚</p>
<h1 id="Docker"><a href="#Docker" class="headerlink" title="Docker"></a>Docker</h1><p>æˆ‘å°è¯•äº†è‡ªå·±å†™webé¢˜ç›®ï¼Œè¿™å°±è¦ç”¨åˆ°dockerçš„çŸ¥è¯†ã€‚dockeré‡Œæœ‰2ä¸ªå¾ˆé‡è¦çš„æ¦‚å¿µï¼šå®¹å™¨å’Œé•œåƒã€‚å®¹å™¨å’Œé•œåƒç±»ä¼¼äºå¯¹è±¡å’Œç±»ã€‚æ¯é“é¢˜ç›®å®é™…ä¸Šæ˜¯å®ä¾‹åŒ–æˆ–é”€æ¯ä¸€ä¸ªdockeré•œåƒã€‚</p>
<p>åœ¨ <a target="_blank" rel="noopener" href="https://www.yuque.com/docs/share/364ef08c-9405-45fe-b269-e9236de57242#OE1rs">https://www.yuque.com/docs/share/364ef08c-9405-45fe-b269-e9236de57242?#OE1rs</a> é‡Œå‘æ”¾webé¢˜ç›®æ—¶æœ‰ä¸€ä¸ª<code>Docker Images</code>å¡«å†™çš„æ˜¯ctftraining&#x2F;qwb_2019_supersqilã€‚docker imageså°±æ˜¯é•œåƒï¼Œæˆ‘ä»¬å¡«å†™çš„é•œåƒåå­—æ˜¯ctftraining&#x2F;qwb_2019_supersqilï¼Œä½†æ˜¯æˆ‘ä»¬æœ¬åœ°æ²¡æœ‰è¿™ä¸ªé•œåƒå•Šï¼Œæ€ä¹ˆè¿˜æ˜¯åˆ›å»ºæˆåŠŸäº†å‘¢ï¼Ÿæ˜¯å› ä¸ºï¼š</p>
<blockquote>
<p>å½“è¿è¡Œå®¹å™¨æ—¶ï¼Œä½¿ç”¨çš„é•œåƒå¦‚æœåœ¨æœ¬åœ°ä¸­ä¸å­˜åœ¨ï¼Œdocker å°±ä¼šè‡ªåŠ¨ä» docker é•œåƒä»“åº“ä¸­ä¸‹è½½ï¼Œé»˜è®¤æ˜¯ä» Docker Hub å…¬å…±é•œåƒæºä¸‹è½½ã€‚</p>
</blockquote>
<p>æˆ‘ä»¬å¯ä»¥ä»Docker Hubç½‘ç«™ä¸ŠæŸ¥æ‰¾é•œåƒï¼š<a target="_blank" rel="noopener" href="https://hub.docker.com/">Docker Hub Container Image Library | App Containerization</a> </p>
<p>é‚£å¦‚ä½•è‡ªå·±å‡ºé¢˜ç›®ï¼Œè‡ªå·±åˆ›å»ºé•œåƒæã€‚æˆ‘æŸ¥é˜…äº†èœé¸Ÿæ•™ç¨‹ä¸Šdockerçš„çŸ¥è¯†ï¼Œæ‡‚äº†å¤§æ¦‚ã€‚</p>
<p>å¯ä»¥åˆ©ç”¨æœ¬åœ°æœ‰çš„é•œåƒï¼Œå®ä¾‹åŒ–æˆå®¹å™¨åï¼Œä½¿ç”¨<code>docker exec -it id /bin/sh</code>å‘½ä»¤è¿›å…¥å®¹å™¨ï¼Œè¿›è¡Œwebç¯å¢ƒçš„æ­å»ºã€‚æ­å»ºå¥½åexité€€å‡ºå®¹å™¨ã€‚å†ä½¿ç”¨<code>docker commit id image</code>ä»å·²ç»åˆ›å»ºçš„å®¹å™¨ä¸­æ›´æ–°é•œåƒï¼Œå¹¶ä¸”æäº¤è¿™ä¸ªé•œåƒã€‚æœ€ååœ¨å‘æ”¾webé¢˜ç›®æ—¶docker imageså¡«å†™æˆ‘ä»¬ç”Ÿæˆçš„imageåå­—å°±è¡Œäº†ã€‚</p>
<p><em>ä¸€äº›å¸¸ç”¨å‘½ä»¤ï¼š</em></p>
<p><strong>å®¹å™¨ï¼š</strong></p>
<table>
<thead>
<tr>
<th>å‘½ä»¤</th>
<th>åŠŸèƒ½</th>
</tr>
</thead>
<tbody><tr>
<td>docker ps -a</td>
<td>åˆ—å‡ºæ‰€æœ‰dockerè¿›ç¨‹ï¼Œå¯ä»¥æŸ¥çœ‹idã€çŠ¶æ€â€¦â€¦</td>
</tr>
<tr>
<td>docker stop id</td>
<td>å…³é—­æŒ‡å®šidçš„dockerè¿›ç¨‹</td>
</tr>
<tr>
<td>docker start id</td>
<td>å¼€å¯æŒ‡å®šidçš„dockerè¿›ç¨‹</td>
</tr>
<tr>
<td>docker rm -f id</td>
<td>åˆ é™¤æŒ‡å®šidçš„dockerå®¹å™¨</td>
</tr>
<tr>
<td>docker exec -it id &#x2F;bin&#x2F;sh</td>
<td>è¿›å…¥æŒ‡å®šidçš„dockerå®¹å™¨</td>
</tr>
<tr>
<td>docker commit id image</td>
<td>ä»å·²ç»åˆ›å»ºçš„å®¹å™¨ä¸­æ›´æ–°é•œåƒï¼Œå¹¶ä¸”æäº¤è¿™ä¸ªé•œåƒ</td>
</tr>
</tbody></table>
<p><strong>é•œåƒï¼š</strong></p>
<table>
<thead>
<tr>
<th>å‘½ä»¤</th>
<th>åŠŸèƒ½</th>
</tr>
</thead>
<tbody><tr>
<td>docker images</td>
<td>æŸ¥çœ‹æ‰€æœ‰é•œåƒ</td>
</tr>
<tr>
<td>docker run -it name &#x2F;bin&#x2F;sh</td>
<td>å®ä¾‹åŒ–é•œåƒ</td>
</tr>
<tr>
<td>docker rmi name</td>
<td>åˆ é™¤é•œåƒ</td>
</tr>
</tbody></table>
<hr>

        </div>
        <div class="top-div">
          <ol class="top-box"><li class="top-box-item top-box-level-1"><a class="top-box-link" href="#%E5%9F%BA%E4%BA%8Edocker%E6%90%AD%E5%BB%BA%E6%94%AF%E6%8C%81%E5%8A%A8%E6%80%81%E9%9D%B6%E6%9C%BA%E7%9A%84%E9%9D%B6%E5%9C%BA"><span class="top-box-text">åŸºäºdockeræ­å»ºæ”¯æŒåŠ¨æ€é¶æœºçš„é¶åœº</span></a><ol class="top-box-child"><li class="top-box-item top-box-level-2"><a class="top-box-link" href="#%E6%88%91%E7%9A%84%E7%8E%AF%E5%A2%83"><span class="top-box-text">æˆ‘çš„ç¯å¢ƒ</span></a></li><li class="top-box-item top-box-level-2"><a class="top-box-link" href="#%E7%B3%BB%E7%BB%9F%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA%E9%85%8D%E7%BD%AE"><span class="top-box-text">ç³»ç»Ÿç¯å¢ƒæ­å»ºé…ç½®</span></a></li><li class="top-box-item top-box-level-2"><a class="top-box-link" href="#%E9%9D%B6%E5%9C%BA%E7%8E%AF%E5%A2%83"><span class="top-box-text">é¶åœºç¯å¢ƒ</span></a></li></ol></li><li class="top-box-item top-box-level-1"><a class="top-box-link" href="#Docker"><span class="top-box-text">Docker</span></a></li></ol>
        </div>
      </div>
    </div>

    
      <div class="next-post">
        <a class="purple-link" href="/2022/08/29/ctfshow%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/">
          <h3 class="post-title">
            ä¸‹ä¸€ç¯‡ï¼šctfshow_webå…¥é—¨_å‘½ä»¤æ‰§è¡Œ
          </h3>
        </a>
      </div>
    
  </div>




<footer>
<div class="site-footer">
  <div class="social-container">
    
      
        <a href="https://github.com/" target="_blank">
          <i class="icon icon-github"></i>
        </a>
      
    
      
        <a href="https://twitter.com/" target="_blank">
          <i class="icon icon-twitter"></i>
        </a>
      
    
      
    
      
    
      
    
  </div>
  
    Powered by <a href="https://hexo.io/" target="_blank">Hexo</a> <a href="https://github.com/f-dong/hexo-theme-minimalism" target="_blank">Theme</a>
  
  
  
  
  
  
</div>
</footer>


      </div>
      
    <script src="/js/jquery.min.js"></script>
    <script src="/js/jquery.fancybox.min.js"></script>


<script id="hexo-configurations">
    window.theme_config = {"image":{"lazyload_enable":false}};
    window.is_post = true;
  </script>

<script src="/js/main.js"></script>





    </div>
  </body>
</html>

